<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Contributing Guide #   Getting started #  chezmoi is written in Go and development happens on GitHub. The rest of this document assumes that you&rsquo;ve checked out chezmoi locally.
The Architecture Guide contains a high-level overview of chezmoi&rsquo;s source code.
 Developing locally #  chezmoi requires Go 1.16 or later.
chezmoi is a standard Go project, using standard Go tooling.
Build chezmoi:
$ go build Run all tests:">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Contributing" />
<meta property="og:description" content="Contributing Guide #   Getting started #  chezmoi is written in Go and development happens on GitHub. The rest of this document assumes that you&rsquo;ve checked out chezmoi locally.
The Architecture Guide contains a high-level overview of chezmoi&rsquo;s source code.
 Developing locally #  chezmoi requires Go 1.16 or later.
chezmoi is a standard Go project, using standard Go tooling.
Build chezmoi:
$ go build Run all tests:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chezmoi.io/docs/contributing/" /><meta property="article:section" content="docs" />



<title>Contributing | chezmoi.io</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css" integrity="sha256-RhgbyTN1upMgJudTs3xA5v&#43;LsWqe93DHi8xmPkV3sbo=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.640d2a020649249a3cb51a61ac3c317b04cc303781b89688ee7930006ef29c39.js" integrity="sha256-ZA0qAgZJJJo8tRphrDwxewTMMDeBuJaI7nkwAG7ynDk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo-144px.svg" alt="Logo" /><span>chezmoi.io</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  <ul>
<li><a href="/docs/install/">Install</a></li>
<li><a href="/docs/quick-start/">Quick Start</a></li>
<li><a href="/docs/how-to/">How-To</a></li>
<li><a href="/docs/templating/">Templating</a></li>
<li><a href="/docs/faq/">FAQ</a></li>
<li><a href="/docs/changes/">Changes</a></li>
<li><a href="/docs/reference/">Reference</a></li>
<li><a href="/docs/media/">Media</a></li>
<li><a href="/docs/comparison/">Comparison</a></li>
<li><a href="/docs/contributing/"class=active>Contributing</a></li>
<li><a href="/docs/architecture/">Architecture</a></li>
<li><a href="/docs/related/">Related Software</a></li>
<li><a href="/docs/security/">Security</a></li>
<li><a href="https://github.com/twpayne/chezmoi">GitHub</a></li>
</ul>










</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Contributing</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#getting-started">Getting started</a></li>
    <li><a href="#developing-locally">Developing locally</a></li>
    <li><a href="#generated-code">Generated code</a></li>
    <li><a href="#contributing-changes">Contributing changes</a></li>
    <li><a href="#managing-releases">Managing releases</a></li>
    <li><a href="#building-and-installing-with-make">Building and installing with <code>make</code></a></li>
    <li><a href="#packaging">Packaging</a></li>
    <li><a href="#updating-the-website">Updating the website</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="contributing-guide">
  Contributing Guide
  <a class="anchor" href="#contributing-guide">#</a>
</h1>
<hr>
<h2 id="getting-started">
  Getting started
  <a class="anchor" href="#getting-started">#</a>
</h2>
<p>chezmoi is written in <a href="https://golang.org">Go</a> and development happens on
<a href="https://github.com">GitHub</a>. The rest of this document assumes that you&rsquo;ve
checked out chezmoi locally.</p>
<p>The <a href="ARCHITECTURE.md">Architecture Guide</a> contains a high-level overview of
chezmoi&rsquo;s source code.</p>
<hr>
<h2 id="developing-locally">
  Developing locally
  <a class="anchor" href="#developing-locally">#</a>
</h2>
<p>chezmoi requires Go 1.16 or later.</p>
<p>chezmoi is a standard Go project, using standard Go tooling.</p>
<p>Build chezmoi:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ go build
</code></pre></div><p>Run all tests:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ go test ./...
</code></pre></div><p>chezmoi&rsquo;s tests include integration tests with other software. If the other
software is not found in <code>$PATH</code> the tests will be skipped. Running the full set
of tests requires <code>age</code>, <code>base64</code>, <code>bash</code>, <code>gpg</code>, <code>perl</code>, <code>python</code>, <code>ruby</code>,
<code>sed</code>, <code>sha256sum</code>, <code>unzip</code>, and <code>zip</code>.</p>
<p>Run chezmoi:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ go run .
</code></pre></div><p>Run a set of smoketests, including cross-compilation, tests, and linting:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ make smoketest
</code></pre></div><hr>
<h2 id="generated-code">
  Generated code
  <a class="anchor" href="#generated-code">#</a>
</h2>
<p>chezmoi generates the install script and the website from a single source of
truth. You must run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ go generate
</code></pre></div><p>if you change includes any of the following:</p>
<ul>
<li>Adds or modifies the list of supported OSs and architectures.</li>
<li>Modifies the install script template.</li>
</ul>
<p>chezmoi&rsquo;s continuous integration verifies that all generated files are up to
date. Changes to generated files should be included in the commit that modifies
the source of truth.</p>
<hr>
<h2 id="contributing-changes">
  Contributing changes
  <a class="anchor" href="#contributing-changes">#</a>
</h2>
<p>Bug reports, bug fixes, and documentation improvements are always welcome.
Please <a href="https://github.com/twpayne/chezmoi/issues/new/choose">open an issue</a> or
<a href="https://help.github.com/en/articles/creating-a-pull-request">create a pull
request</a> with your
report, fix, or improvement.</p>
<p>If you want to make a more significant change, please first <a href="https://github.com/twpayne/chezmoi/issues/new/choose">open an
issue</a> to discuss the
change that you want to make. Dave Cheney gives a <a href="https://dave.cheney.net/2019/02/18/talk-then-code">good
rationale</a> as to why this is
important.</p>
<p>All changes are made via pull requests. In your pull request, please make sure
that:</p>
<ul>
<li>
<p>All existing tests pass.</p>
</li>
<li>
<p>There are appropriate additional tests that demonstrate that your PR works as
intended.</p>
</li>
<li>
<p>The documentation is updated, if necessary. For new features you should add an
entry in <code>docs/HOWTO.md</code> and a complete description in <code>docs/REFERENCE.md</code>.</p>
</li>
<li>
<p>All generated files are up to date. You can ensure this by running <code>make generate</code> and including any modified files in your commit.</p>
</li>
<li>
<p>The code is correctly formatted, according to
<a href="https://mvdan.cc/gofumpt/"><code>gofumpt</code></a>. You can ensure this by running <code>make format</code>.</p>
</li>
<li>
<p>The code passes <a href="https://github.com/golangci/golangci-lint"><code>golangci-lint</code></a>.
You can ensure this by running <code>make lint</code>.</p>
</li>
<li>
<p>The commit messages follow the <a href="https://www.conventionalcommits.org/en/v1.0.0/">conventional commits
specification</a>.</p>
</li>
<li>
<p>Commits are logically separate, with no merge or &ldquo;fixup&rdquo; commits.</p>
</li>
<li>
<p>The branch applies cleanly to <code>master</code>.</p>
</li>
</ul>
<hr>
<h2 id="managing-releases">
  Managing releases
  <a class="anchor" href="#managing-releases">#</a>
</h2>
<p>Releases are managed with <a href="https://goreleaser.com/"><code>goreleaser</code></a>.</p>
<p>To build a test release, without publishing, (Linux only) run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ make test-release
</code></pre></div><p>Publish a new release by creating and pushing a tag, e.g.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ git tag v1.2.3
$ git push --tags
</code></pre></div><p>This triggers a <a href="https://github.com/twpayne/chezmoi/actions">GitHub Action</a> that
builds and publishes archives, packages, and snaps, and creates a new <a href="https://github.com/twpayne/chezmoi/releases">GitHub
Release</a>.</p>
<p>Publishing <a href="https://snapcraft.io/">Snaps</a> requires a <code>SNAPCRAFT_LOGIN</code>
<a href="https://github.com/twpayne/chezmoi/settings/secrets/actions">repository
secret</a>. Snapcraft
logins periodically expire. Create a new snapcraft login by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ snapcraft export-login --snaps<span style="color:#f92672">=</span>chezmoi --channels<span style="color:#f92672">=</span>stable,candidate,beta,edge --acls<span style="color:#f92672">=</span>package_upload -
</code></pre></div><p><a href="https://brew.sh/">brew</a> automation will automatically detect new releases of
chezmoi within a few hours and open a pull request in
<a href="github.com/Homebrew/homebrew-core">https://github.com/Homebrew/homebrew-core</a>
to bump the version.</p>
<p>If needed, the pull request can be created with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ brew bump-formula-pr --tag<span style="color:#f92672">=</span>v1.2.3 chezmoi
</code></pre></div><hr>
<h2 id="building-and-installing-with-make">
  Building and installing with <code>make</code>
  <a class="anchor" href="#building-and-installing-with-make">#</a>
</h2>
<p>chezmoi can be built with GNU make, assuming you have the Go toolchain
installed.</p>
<p>Running <code>make</code> will build a <code>chezmoi</code> binary in the current directory for the
host OS and architecture. To embed version information in the binary and control
installation the following variables are available:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Example</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$VERSION</code></td>
<td><code>v2.0.0</code></td>
<td>Set version</td>
</tr>
<tr>
<td><code>$COMMIT</code></td>
<td><code>3895680a</code>&hellip;</td>
<td>Set the git commit at which the code was built</td>
</tr>
<tr>
<td><code>$DATE</code></td>
<td><code>2019-11-23T18:29:25Z</code></td>
<td>The time of the build</td>
</tr>
<tr>
<td><code>$BUILT_BY</code></td>
<td><code>homebrew</code></td>
<td>The packaging system performing the build</td>
</tr>
<tr>
<td><code>$PREFIX</code></td>
<td><code>/usr</code></td>
<td>Installation prefix</td>
</tr>
<tr>
<td><code>$DESTDIR</code></td>
<td><code>install-root</code></td>
<td>Fake installation root</td>
</tr>
</tbody>
</table>
<p>Running <code>make install</code> will install the <code>chezmoi</code> binary in <code>${DESTDIR}${PREFIX}/bin</code>.</p>
<hr>
<h2 id="packaging">
  Packaging
  <a class="anchor" href="#packaging">#</a>
</h2>
<p>If you&rsquo;re packaging chezmoi for an operating system or distribution:</p>
<ul>
<li>
<p>chezmoi has no build dependencies other than the standard Go toolchain.</p>
</li>
<li>
<p>chezmoi has no runtime dependencies, but is usually used with <code>git</code>, so many
packagers choose to make <code>git</code> an install dependency or recommended package.</p>
</li>
<li>
<p>Please set the version number, git commit, and build time in the binary. This
greatly assists debugging when end users report problems or ask for help. You
can do this by passing the following flags to <code>go build</code>:</p>
<pre tabindex="0"><code>-ldflags &quot;-X main.version=$VERSION
          -X main.commit=$COMMIT
          -X main.date=$DATE
          -X main.builtBy=$BUILT_BY&quot;
</code></pre><p><code>$VERSION</code> should be the chezmoi version, e.g. <code>1.7.3</code>. Any <code>v</code> prefix is
optional and will be stripped, so you can pass the git tag in directly. The
command <code>git describe --abbrev=0 --tags</code> will return a suitable value.</p>
<p><code>$COMMIT</code> should be the full git commit hash at which chezmoi is built, e.g.
<code>4d678ce6850c9d81c7ab2fe0d8f20c1547688b91</code>. The command <code>git rev-parse HEAD</code>
will return a suitable value.</p>
<p><code>$DATE</code> should be the date of the build as a UNIX timestamp or in RFC3339
format. The command <code>git show -s --format=%ct HEAD</code> returns the UNIX timestamp
of the last commit, e.g. <code>1636668628</code>. The command <code>date -u +%Y-%m-%dT%H:%M:%SZ</code> returns the current time in RFC3339 format, e.g.
<code>2019-11-23T18:29:25Z</code>.</p>
<p><code>$BUILT_BY</code> should be a string indicating what system was used to build the
binary. Typically it should be the name of your packaging system, e.g.
<code>homebrew</code>.</p>
</li>
<li>
<p>Please enable cgo, if possible. chezmoi can be built and run without cgo, but
the <code>.chezmoi.username</code> and <code>.chezmoi.group</code> template variables may not be set
correctly on some systems.</p>
</li>
<li>
<p>chezmoi includes an <code>upgrade</code> command which attempts to self-upgrade. You can
remove this command completely by building chezmoi with the <code>noupgrade</code> build
tag.</p>
</li>
<li>
<p>chezmoi includes shell completions in the <code>completions</code> directory. Please
include these in the package and install them in the shell-appropriate
directory, if possible.</p>
</li>
<li>
<p>If the instructions for installing chezmoi in chezmoi&rsquo;s <a href="/docs/install/">install
guide</a> are
absent or incorrect, please open an issue or submit a PR to correct them.</p>
</li>
</ul>
<hr>
<h2 id="updating-the-website">
  Updating the website
  <a class="anchor" href="#updating-the-website">#</a>
</h2>
<p><a href="https://chezmoi.io">The website</a> is generated with <a href="https://gohugo.io/">Hugo</a>
and served with <a href="https://pages.github.com/">GitHub pages</a> from the <a href="https://github.com/twpayne/chezmoi/tree/gh-pages"><code>gh-pages</code>
branch</a> to GitHub.</p>
<p>chezmoi requires the extended version of Hugo which includes Sass/SCSS support.
You can verify your Hugo version by looking for <code>extended</code> in the output of
<code>hugo version</code>, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ hugo version
hugo v0.90.0+extended darwin/arm64 BuildDate=unknown
</code></pre></div><p>Before building the website, you must download the <a href="https://github.com/alex-shpak/hugo-book">Hugo Book
Theme</a> by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ git submodule update --init
</code></pre></div><p>Test the website locally by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ <span style="color:#f92672">(</span> cd assets/chezmoi.io <span style="color:#f92672">&amp;&amp;</span> hugo serve <span style="color:#f92672">)</span>
</code></pre></div><p>and visit http://localhost:1313/.</p>
<p>To build the website in a temporary directory, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ <span style="color:#f92672">(</span> cd assets/chezmoi.io <span style="color:#f92672">&amp;&amp;</span> make <span style="color:#f92672">)</span>
</code></pre></div><p>From here you can run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ git show
</code></pre></div><p>to show changes and</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ git push
</code></pre></div><p>to push them. You can only push changes if you have write permissions to the
chezmoi GitHub repo.</p>
<hr>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#getting-started">Getting started</a></li>
    <li><a href="#developing-locally">Developing locally</a></li>
    <li><a href="#generated-code">Generated code</a></li>
    <li><a href="#contributing-changes">Contributing changes</a></li>
    <li><a href="#managing-releases">Managing releases</a></li>
    <li><a href="#building-and-installing-with-make">Building and installing with <code>make</code></a></li>
    <li><a href="#packaging">Packaging</a></li>
    <li><a href="#updating-the-website">Updating the website</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












