<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="How-To Guide #   Perform daily operations #   Use a hosted repo to manage your dotfiles across multiple machines #  chezmoi relies on your version control system and hosted repo to share changes across multiple machines. You should create a repo on the source code repository of your choice (e.g. Bitbucket, GitHub, or GitLab, many people call their repo dotfiles) and push the repo in the source directory here.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="How-To" />
<meta property="og:description" content="How-To Guide #   Perform daily operations #   Use a hosted repo to manage your dotfiles across multiple machines #  chezmoi relies on your version control system and hosted repo to share changes across multiple machines. You should create a repo on the source code repository of your choice (e.g. Bitbucket, GitHub, or GitLab, many people call their repo dotfiles) and push the repo in the source directory here." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chezmoi.io/docs/how-to/" /><meta property="article:section" content="docs" />



<title>How-To | chezmoi.io</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css" integrity="sha256-RhgbyTN1upMgJudTs3xA5v&#43;LsWqe93DHi8xmPkV3sbo=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.decff7115d83a47e2514520e203cd472ce3f01abb357848b8e4aa1afa364520a.js" integrity="sha256-3s/3EV2DpH4lFFIOIDzUcs4/AauzV4SLjkqhr6NkUgo=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo-144px.svg" alt="Logo" /><span>chezmoi.io</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  <ul>
<li><a href="/docs/install/">Install</a></li>
<li><a href="/docs/quick-start/">Quick Start</a></li>
<li><a href="/docs/how-to/"class=active>How-To</a></li>
<li><a href="/docs/templating/">Templating</a></li>
<li><a href="/docs/faq/">FAQ</a></li>
<li><a href="/docs/changes/">Changes</a></li>
<li><a href="/docs/reference/">Reference</a></li>
<li><a href="/docs/media/">Media</a></li>
<li><a href="/docs/comparison/">Comparison</a></li>
<li><a href="/docs/contributing/">Contributing</a></li>
<li><a href="/docs/architecture/">Architecture</a></li>
<li><a href="/docs/related/">Related Software</a></li>
<li><a href="/docs/security/">Security</a></li>
<li><a href="https://github.com/twpayne/chezmoi">GitHub</a></li>
</ul>










</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>How-To</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#perform-daily-operations">Perform daily operations</a>
      <ul>
        <li><a href="#use-a-hosted-repo-to-manage-your-dotfiles-across-multiple-machines">Use a hosted repo to manage your dotfiles across multiple machines</a></li>
        <li><a href="#use-a-private-repo-to-store-your-dotfiles">Use a private repo to store your dotfiles</a></li>
        <li><a href="#pull-the-latest-changes-from-your-repo-and-apply-them">Pull the latest changes from your repo and apply them</a></li>
        <li><a href="#pull-the-latest-changes-from-your-repo-and-see-what-would-change-without-actually-applying-the-changes">Pull the latest changes from your repo and see what would change, without actually applying the changes</a></li>
        <li><a href="#automatically-commit-and-push-changes-to-your-repo">Automatically commit and push changes to your repo</a></li>
        <li><a href="#install-chezmoi-and-your-dotfiles-on-a-new-machine-with-a-single-command">Install chezmoi and your dotfiles on a new machine with a single command</a></li>
      </ul>
    </li>
    <li><a href="#manage-different-types-of-file">Manage different types of file</a>
      <ul>
        <li><a href="#have-chezmoi-create-a-directory-but-ignore-its-contents">Have chezmoi create a directory, but ignore its contents</a></li>
        <li><a href="#ensure-that-a-target-is-removed">Ensure that a target is removed</a></li>
        <li><a href="#manage-part-but-not-all-of-a-file">Manage part, but not all, of a file</a></li>
        <li><a href="#manage-a-files-permissions-but-not-its-contents">Manage a file&rsquo;s permissions, but not its contents</a></li>
        <li><a href="#populate-sshauthorized_keys-with-your-public-ssh-keys-from-github">Populate <code>~/.ssh/authorized_keys</code> with your public SSH keys from GitHub</a></li>
      </ul>
    </li>
    <li><a href="#integrate-chezmoi-with-your-editor">Integrate chezmoi with your editor</a>
      <ul>
        <li><a href="#use-your-preferred-editor-with-chezmoi-edit-and-chezmoi-edit-config">Use your preferred editor with <code>chezmoi edit</code> and <code>chezmoi edit-config</code></a></li>
        <li><a href="#configure-vim-to-run-chezmoi-apply-whenever-you-save-a-dotfile">Configure VIM to run <code>chezmoi apply</code> whenever you save a dotfile</a></li>
      </ul>
    </li>
    <li><a href="#include-dotfiles-from-elsewhere">Include dotfiles from elsewhere</a>
      <ul>
        <li><a href="#include-a-subdirectory-from-another-repository-like-oh-my-zsh">Include a subdirectory from another repository, like Oh My Zsh</a></li>
        <li><a href="#include-a-single-file-from-another-repository">Include a single file from another repository</a></li>
        <li><a href="#handle-configuration-files-which-are-externally-modified">Handle configuration files which are externally modified</a></li>
        <li><a href="#import-archives">Import archives</a></li>
      </ul>
    </li>
    <li><a href="#manage-machine-to-machine-differences">Manage machine-to-machine differences</a>
      <ul>
        <li><a href="#use-templates">Use templates</a></li>
        <li><a href="#ignore-files-or-a-directory-on-different-machines">Ignore files or a directory on different machines</a></li>
        <li><a href="#use-completely-different-dotfiles-on-different-machines">Use completely different dotfiles on different machines</a></li>
        <li><a href="#create-a-config-file-on-a-new-machine-automatically">Create a config file on a new machine automatically</a></li>
        <li><a href="#re-create-your-config-file">Re-create your config file</a></li>
        <li><a href="#handle-different-file-locations-on-different-systems-with-the-same-contents">Handle different file locations on different systems with the same contents</a></li>
        <li><a href="#create-an-archive-of-your-dotfiles">Create an archive of your dotfiles</a></li>
      </ul>
    </li>
    <li><a href="#keep-data-private">Keep data private</a>
      <ul>
        <li><a href="#use-1password">Use 1Password</a></li>
        <li><a href="#use-bitwarden">Use Bitwarden</a></li>
        <li><a href="#use-gopass">Use gopass</a></li>
        <li><a href="#use-keepassxc">Use KeePassXC</a></li>
        <li><a href="#use-keychain-or-windows-credentials-manager">Use Keychain or Windows Credentials Manager</a></li>
        <li><a href="#use-lastpass">Use LastPass</a></li>
        <li><a href="#use-pass">Use pass</a></li>
        <li><a href="#use-vault">Use Vault</a></li>
        <li><a href="#use-a-custom-password-manager">Use a custom password manager</a></li>
        <li><a href="#encrypt-whole-files-with-gpg">Encrypt whole files with gpg</a></li>
        <li><a href="#encrypt-whole-files-with-age">Encrypt whole files with age</a></li>
        <li><a href="#use-a-private-configuration-file-and-template-variables">Use a private configuration file and template variables</a></li>
      </ul>
    </li>
    <li><a href="#use-scripts-to-perform-actions">Use scripts to perform actions</a>
      <ul>
        <li><a href="#understand-how-scripts-work">Understand how scripts work</a></li>
        <li><a href="#install-packages-with-scripts">Install packages with scripts</a></li>
        <li><a href="#run-a-script-when-the-contents-of-another-file-changes">Run a script when the contents of another file changes</a></li>
        <li><a href="#clear-the-state-of-run_once_-scripts">Clear the state of <code>run_once_</code> scripts</a></li>
      </ul>
    </li>
    <li><a href="#use-chezmoi-on-macos">Use chezmoi on macOS</a>
      <ul>
        <li><a href="#use-brew-bundle-to-manage-your-brews-and-casks">Use <code>brew bundle</code> to manage your brews and casks</a></li>
      </ul>
    </li>
    <li><a href="#use-chezmoi-on-windows">Use chezmoi on Windows</a>
      <ul>
        <li><a href="#detect-windows-subsystem-for-linux-wsl">Detect Windows Subsystem for Linux (WSL)</a></li>
        <li><a href="#run-a-powershell-script-as-admin-on-windows">Run a PowerShell script as admin on Windows</a></li>
      </ul>
    </li>
    <li><a href="#use-chezmoi-with-github-codespaces-visual-studio-codespaces-or-visual-studio-code-remote---containers">Use chezmoi with GitHub Codespaces, Visual Studio Codespaces, or Visual Studio Code Remote - Containers</a></li>
    <li><a href="#customize-chezmoi">Customize chezmoi</a>
      <ul>
        <li><a href="#use-a-subdirectory-of-your-dotfiles-repo-as-the-root-of-the-source-state">Use a subdirectory of your dotfiles repo as the root of the source state</a></li>
        <li><a href="#dont-show-scripts-in-the-diff-output">Don&rsquo;t show scripts in the diff output</a></li>
        <li><a href="#customize-the-diff-pager">Customize the diff pager</a></li>
        <li><a href="#use-a-custom-diff-tool">Use a custom diff tool</a></li>
        <li><a href="#use-a-custom-merge-tool">Use a custom merge tool</a></li>
        <li><a href="#use-an-http-or-socks5-proxy">Use an HTTP or SOCKS5 proxy</a></li>
      </ul>
    </li>
    <li><a href="#migrating-to-chezmoi-from-another-dotfile-manager">Migrating to chezmoi from another dotfile manager</a>
      <ul>
        <li><a href="#migrate-from-a-dotfile-manager-that-uses-symlinks">Migrate from a dotfile manager that uses symlinks</a></li>
      </ul>
    </li>
    <li><a href="#migrate-away-from-chezmoi">Migrate away from chezmoi</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="how-to-guide">
  How-To Guide
  <a class="anchor" href="#how-to-guide">#</a>
</h1>
<hr>
<h2 id="perform-daily-operations">
  Perform daily operations
  <a class="anchor" href="#perform-daily-operations">#</a>
</h2>
<hr>
<h3 id="use-a-hosted-repo-to-manage-your-dotfiles-across-multiple-machines">
  Use a hosted repo to manage your dotfiles across multiple machines
  <a class="anchor" href="#use-a-hosted-repo-to-manage-your-dotfiles-across-multiple-machines">#</a>
</h3>
<p>chezmoi relies on your version control system and hosted repo to share changes
across multiple machines. You should create a repo on the source code repository
of your choice (e.g. <a href="https://bitbucket.org">Bitbucket</a>,
<a href="https://github.com/">GitHub</a>, or <a href="https://gitlab.com">GitLab</a>, many people call
their repo <code>dotfiles</code>) and push the repo in the source directory here. For
example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi cd
$ git remote add origin https://github.com/username/dotfiles.git
$ git push -u origin main
$ exit
</code></pre></div><p>On another machine you can checkout this repo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi init https://github.com/username/dotfiles.git
</code></pre></div><p>You can then see what would be changed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi diff
</code></pre></div><p>If you&rsquo;re happy with the changes then apply them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi apply
</code></pre></div><p>The above commands can be combined into a single init, checkout, and apply:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi init --apply --verbose https://github.com/username/dotfiles.git
</code></pre></div><hr>
<h3 id="use-a-private-repo-to-store-your-dotfiles">
  Use a private repo to store your dotfiles
  <a class="anchor" href="#use-a-private-repo-to-store-your-dotfiles">#</a>
</h3>
<p>chezmoi supports storing your dotfiles in both public and private repos.</p>
<p>chezmoi is designed so that your dotfiles repo can be public by making it easy
for you to store your secrets either in your password manager, in encrypted
files, or in private configuration files. Your dotfiles repo can still be
private, if you choose.</p>
<p>If you use a private repo for your dotfiles then you will typically need to
enter your credentials (e.g. your username and password) each time you interact
with the repo, for example when pulling or pushing changes. chezmoi itself does
not store any credentials, but instead relies on your local git configuration
for these operations.</p>
<p>When using a private repo on GitHub without <code>--ssh</code>, when prompted for a
password you will need to enter a <a href="https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token">GitHub personal access
token</a>.
For more information on these changes, read the <a href="https://github.blog/2020-12-15-token-authentication-requirements-for-git-operations/">GitHub blog post on Token
authentication requirements for Git
operations</a></p>
<hr>
<h3 id="pull-the-latest-changes-from-your-repo-and-apply-them">
  Pull the latest changes from your repo and apply them
  <a class="anchor" href="#pull-the-latest-changes-from-your-repo-and-apply-them">#</a>
</h3>
<p>You can pull the changes from your repo and apply them in a single command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi update
</code></pre></div><p>This runs <code>git pull --rebase</code> in your source directory and then <code>chezmoi apply</code>.</p>
<hr>
<h3 id="pull-the-latest-changes-from-your-repo-and-see-what-would-change-without-actually-applying-the-changes">
  Pull the latest changes from your repo and see what would change, without actually applying the changes
  <a class="anchor" href="#pull-the-latest-changes-from-your-repo-and-see-what-would-change-without-actually-applying-the-changes">#</a>
</h3>
<p>Run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi git pull -- --rebase <span style="color:#f92672">&amp;&amp;</span> chezmoi diff
</code></pre></div><p>This runs <code>git pull --rebase</code> in your source directory and <code>chezmoi diff</code> then shows the difference between the target state computed from your
source directory and the actual state.</p>
<p>If you&rsquo;re happy with the changes, then you can run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi apply
</code></pre></div><p>to apply them.</p>
<hr>
<h3 id="automatically-commit-and-push-changes-to-your-repo">
  Automatically commit and push changes to your repo
  <a class="anchor" href="#automatically-commit-and-push-changes-to-your-repo">#</a>
</h3>
<p>chezmoi can automatically commit and push changes to your source directory to
your repo. This feature is disabled by default. To enable it, add the following
to your config file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">git</span>]
    <span style="color:#a6e22e">autoCommit</span> = <span style="color:#66d9ef">true</span>
    <span style="color:#a6e22e">autoPush</span> = <span style="color:#66d9ef">true</span>
</code></pre></div><p>Whenever a change is made to your source directory, chezmoi will commit the
changes with an automatically-generated commit message (if <code>autoCommit</code> is true)
and push them to your repo (if <code>autoPush</code> is true). <code>autoPush</code> implies
<code>autoCommit</code>, i.e. if <code>autoPush</code> is true then chezmoi will auto-commit your
changes. If you only set <code>autoCommit</code> to true then changes will be committed but
not pushed.</p>
<p>Be careful when using <code>autoPush</code>. If your dotfiles repo is public and you
accidentally add a secret in plain text, that secret will be pushed to your
public repo.</p>
<hr>
<h3 id="install-chezmoi-and-your-dotfiles-on-a-new-machine-with-a-single-command">
  Install chezmoi and your dotfiles on a new machine with a single command
  <a class="anchor" href="#install-chezmoi-and-your-dotfiles-on-a-new-machine-with-a-single-command">#</a>
</h3>
<p>chezmoi&rsquo;s install script can run <code>chezmoi init</code> for you by passing extra
arguments to the newly installed chezmoi binary. If your dotfiles repo is
<code>github.com/&lt;github-username&gt;/dotfiles</code> then installing chezmoi, running
<code>chezmoi init</code>, and running <code>chezmoi apply</code> can be done in a single line of
shell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -fsLS chezmoi.io/get<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -- init --apply &lt;github-username&gt;
</code></pre></div><p>If your dotfiles repo has a different name to <code>dotfiles</code>, or if you host your
dotfiles on a different service, then see the <a href="/docs/reference/#init-repo">reference manual for <code>chezmoi init</code></a>.</p>
<p>For setting up transitory environments (e.g. short-lived Linux containers) you
can install chezmoi, install your dotfiles, and then remove all traces of
chezmoi, including the source directory and chezmoi&rsquo;s configuration directory,
with a single command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -fsLS chezmoi.io/get<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -- init --one-shot &lt;github-username&gt;
</code></pre></div><hr>
<h2 id="manage-different-types-of-file">
  Manage different types of file
  <a class="anchor" href="#manage-different-types-of-file">#</a>
</h2>
<hr>
<h3 id="have-chezmoi-create-a-directory-but-ignore-its-contents">
  Have chezmoi create a directory, but ignore its contents
  <a class="anchor" href="#have-chezmoi-create-a-directory-but-ignore-its-contents">#</a>
</h3>
<p>If you want chezmoi to create a directory, but ignore its contents, say <code>~/src</code>,
first run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ mkdir -p <span style="color:#66d9ef">$(</span>chezmoi source-path<span style="color:#66d9ef">)</span>/src
</code></pre></div><p>This creates the directory in the source state, which means that chezmoi will
create it (if it does not already exist) when you run <code>chezmoi apply</code>.</p>
<p>However, as this is an empty directory it will be ignored by git. So, create a
file in the directory in the source state that will be seen by git (so git does
not ignore the directory) but ignored by chezmoi (so chezmoi does not include it
in the target state):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ touch <span style="color:#66d9ef">$(</span>chezmoi source-path<span style="color:#66d9ef">)</span>/src/.keep
</code></pre></div><p>chezmoi automatically creates <code>.keep</code> files when you add an empty directory with
<code>chezmoi add</code>.</p>
<hr>
<h3 id="ensure-that-a-target-is-removed">
  Ensure that a target is removed
  <a class="anchor" href="#ensure-that-a-target-is-removed">#</a>
</h3>
<p>Create a file called <code>.chezmoiremove</code> in the source directory containing a list
of patterns of files to remove. chezmoi will remove anything in the target
directory that matches the pattern. As this command is potentially dangerous,
you should run chezmoi in verbose, dry-run mode beforehand to see what would be
removed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi apply --dry-run --verbose
</code></pre></div><p><code>.chezmoiremove</code> is interpreted as a template, so you can remove different files
on different machines. Negative matches (patterns prefixed with a <code>!</code>) or
targets listed in <code>.chezmoiignore</code> will never be removed.</p>
<hr>
<h3 id="manage-part-but-not-all-of-a-file">
  Manage part, but not all, of a file
  <a class="anchor" href="#manage-part-but-not-all-of-a-file">#</a>
</h3>
<p>chezmoi, by default, manages whole files, but there are two ways to manage just
parts of a file.</p>
<p>Firstly, a <code>modify_</code> script receives the current contents of the file on the
standard input and chezmoi reads the target contents of the file from the
script&rsquo;s standard output. This can be used to change parts of a file, for
example using <code>sed</code>. Note that if the file does not exist then the standard
input to the <code>modify_</code> script will be empty and it is the script&rsquo;s
responsibility to write a complete file to the standard output.</p>
<p>Secondly, if only a small part of the file changes then consider using a
template to re-generate the full contents of the file from the current state.
For example, Kubernetes configurations include a current context that can be
substituted with:</p>
<pre tabindex="0"><code>current-context: {{ output &quot;kubectl&quot; &quot;config&quot; &quot;current-context&quot; | trim }}
</code></pre><hr>
<h3 id="manage-a-files-permissions-but-not-its-contents">
  Manage a file&rsquo;s permissions, but not its contents
  <a class="anchor" href="#manage-a-files-permissions-but-not-its-contents">#</a>
</h3>
<p>chezmoi&rsquo;s <code>create_</code> attributes allows you to tell chezmoi to create a file if it
does not already exist. chezmoi, however, will apply any permission changes from
the <code>executable_</code>, <code>private_</code>, and <code>readonly_</code> attributes. This can be used to
control a file&rsquo;s permissions without altering its contents.</p>
<p>For example, if you want to ensure that <code>~/.kube/config</code> always has permissions
600 then if you create an empty file called <code>dot_kube/private_dot_config</code> in
your source state, chezmoi will ensure <code>~/.kube/config</code>&rsquo;s permissions are 0600
when you run <code>chezmoi apply</code> without changing its contents.</p>
<p>This approach does have the downside that chezmoi will create the file if it
does not already exist. If you only want <code>chezmoi apply</code> to set a file&rsquo;s
permissions if it already exists and not create the file otherwise, you can use
a <code>run_</code> script. For example, create a file in your source state called
<code>run_set_kube_config_permissions.sh</code> containing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$HOME<span style="color:#e6db74">/.kube/config&#34;</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f <span style="color:#e6db74">&#34;</span>$FILE<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>stat -c %a <span style="color:#e6db74">&#34;</span>$FILE<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;600&#34;</span> <span style="color:#f92672">]</span> ; <span style="color:#66d9ef">then</span>
        chmod <span style="color:#ae81ff">600</span> <span style="color:#e6db74">&#34;</span>$FILE<span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">fi</span>
<span style="color:#66d9ef">fi</span>
</code></pre></div><hr>
<h3 id="populate-sshauthorized_keys-with-your-public-ssh-keys-from-github">
  Populate <code>~/.ssh/authorized_keys</code> with your public SSH keys from GitHub
  <a class="anchor" href="#populate-sshauthorized_keys-with-your-public-ssh-keys-from-github">#</a>
</h3>
<p>chezmoi can retrieve your public SSH keys from GitHub, which can be useful for
populating your <code>~/.ssh/authorized_keys</code>. Put the following in your
<code>~/.local/share/chezmoi/dot_ssh/authorized_keys.tmpl</code>, where <code>username</code> is your
GitHub username:</p>
<pre tabindex="0"><code>{{ range (gitHubKeys &quot;username&quot;) -}}
{{   .Key }}
{{ end -}}
</code></pre><hr>
<h2 id="integrate-chezmoi-with-your-editor">
  Integrate chezmoi with your editor
  <a class="anchor" href="#integrate-chezmoi-with-your-editor">#</a>
</h2>
<hr>
<h3 id="use-your-preferred-editor-with-chezmoi-edit-and-chezmoi-edit-config">
  Use your preferred editor with <code>chezmoi edit</code> and <code>chezmoi edit-config</code>
  <a class="anchor" href="#use-your-preferred-editor-with-chezmoi-edit-and-chezmoi-edit-config">#</a>
</h3>
<p>By default, chezmoi will use your preferred editor as defined by the <code>$VISUAL</code>
or <code>$EDITOR</code> environment variables, falling back to a default editor depending
on your operating system (<code>vi</code> on UNIX-like operating systems, <code>notepad.exe</code> on
Windows).</p>
<p>You can configure chezmoi to use your preferred editor by either setting the
<code>$EDITOR</code> environment variable or setting the <code>edit.command</code> variable in your
configuration file.</p>
<p>The editor command must only return when you have finished editing the files.
chezmoi will emit a warning if your editor command returns too quickly.</p>
<p>In the specific case of using <a href="https://code.visualstudio.com/">VSCode</a> or
<a href="https://vscodium.com/">Codium</a> as your editor, you must pass the <code>--wait</code> flag,
for example, in your shell config:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ export EDITOR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;code --wait&#34;</span>
</code></pre></div><p>Or in chezmoi&rsquo;s configuration file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">edit</span>]
    <span style="color:#a6e22e">command</span> = <span style="color:#e6db74">&#34;code&#34;</span>
    <span style="color:#a6e22e">args</span> = [<span style="color:#e6db74">&#34;--wait&#34;</span>]
</code></pre></div><hr>
<h3 id="configure-vim-to-run-chezmoi-apply-whenever-you-save-a-dotfile">
  Configure VIM to run <code>chezmoi apply</code> whenever you save a dotfile
  <a class="anchor" href="#configure-vim-to-run-chezmoi-apply-whenever-you-save-a-dotfile">#</a>
</h3>
<p>Put the following in your <code>.vimrc</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vim" data-lang="vim"><span style="color:#a6e22e">autocmd</span> <span style="color:#a6e22e">BufWritePost</span> ~<span style="color:#e6db74">/.local/</span><span style="color:#a6e22e">share</span><span style="color:#e6db74">/chezmoi/</span>* ! <span style="color:#a6e22e">chezmoi</span> <span style="color:#a6e22e">apply</span> --<span style="color:#a6e22e">source</span>-<span style="color:#a6e22e">path</span> <span style="color:#e6db74">&#34;%&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><hr>
<h2 id="include-dotfiles-from-elsewhere">
  Include dotfiles from elsewhere
  <a class="anchor" href="#include-dotfiles-from-elsewhere">#</a>
</h2>
<hr>
<h3 id="include-a-subdirectory-from-another-repository-like-oh-my-zsh">
  Include a subdirectory from another repository, like Oh My Zsh
  <a class="anchor" href="#include-a-subdirectory-from-another-repository-like-oh-my-zsh">#</a>
</h3>
<p>To include a subdirectory from another repository, e.g. <a href="https://github.com/ohmyzsh/ohmyzsh">Oh My
Zsh</a>, you cannot use git submodules because
chezmoi uses its own format for the source state and Oh My Zsh is not
distributed in this format. Instead, you can use the <code>.chezmoiexternal.&lt;format&gt;</code>
to tell chezmoi to import dotfiles from an external source.</p>
<p>For example, to import Oh My Zsh, the <a href="https://github.com/zsh-users/zsh-syntax-highlighting">zsh-syntax-highlighting
plugin</a>, and
<a href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a>, put the following in
<code>~/.local/share/chezmoi/.chezmoiexternal.toml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#e6db74">&#34;.oh-my-zsh&#34;</span>]
    <span style="color:#a6e22e">type</span> = <span style="color:#e6db74">&#34;archive&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;https://github.com/ohmyzsh/ohmyzsh/archive/master.tar.gz&#34;</span>
    <span style="color:#a6e22e">exact</span> = <span style="color:#66d9ef">true</span>
    <span style="color:#a6e22e">stripComponents</span> = <span style="color:#ae81ff">1</span>
    <span style="color:#a6e22e">refreshPeriod</span> = <span style="color:#e6db74">&#34;168h&#34;</span>
[<span style="color:#e6db74">&#34;.oh-my-zsh/custom/plugins/zsh-syntax-highlighting&#34;</span>]
    <span style="color:#a6e22e">type</span> = <span style="color:#e6db74">&#34;archive&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;https://github.com/zsh-users/zsh-syntax-highlighting/archive/master.tar.gz&#34;</span>
    <span style="color:#a6e22e">exact</span> = <span style="color:#66d9ef">true</span>
    <span style="color:#a6e22e">stripComponents</span> = <span style="color:#ae81ff">1</span>
    <span style="color:#a6e22e">refreshPeriod</span> = <span style="color:#e6db74">&#34;168h&#34;</span>
[<span style="color:#e6db74">&#34;.oh-my-zsh/custom/themes/powerlevel10k&#34;</span>]
    <span style="color:#a6e22e">type</span> = <span style="color:#e6db74">&#34;archive&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;https://github.com/romkatv/powerlevel10k/archive/v1.15.0.tar.gz&#34;</span>
    <span style="color:#a6e22e">exact</span> = <span style="color:#66d9ef">true</span>
    <span style="color:#a6e22e">stripComponents</span> = <span style="color:#ae81ff">1</span>
</code></pre></div><p>To apply the changes, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi apply
</code></pre></div><p>chezmoi will download the archives and unpack them as if they were part of the
source state. chezmoi caches downloaded archives locally to avoid re-downloading
them every time you run a chezmoi command, and will only re-download them at
most every <code>refreshPeriod</code> (default never).</p>
<p>In the above example <code>refreshPeriod</code> is set to <code>168h</code> (one week) for
<code>.oh-my-zsh</code> and <code>.oh-my-zsh/custom/plugins/zsh-syntax-highlighting</code> because the
URL point to tarballs of the <code>master</code> branch, which changes over time. No
refresh period is set for <code>.oh-my-zsh/custom/themes/powerlevel10k</code> because the
URL points to the a tarball of a tagged version, which does not change over
time. To bump the version of powerlevel10k, change the version in the URL.</p>
<p>To force a refresh the downloaded archives, use the <code>--refresh-externals</code> flag
to <code>chezmoi apply</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi --refresh-externals apply
</code></pre></div><p><code>--refresh-externals</code> can be shortened to <code>-R</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi -R apply
</code></pre></div><p>When using Oh My Zsh, make sure you disable auto-updates by setting
<code>DISABLE_AUTO_UPDATE=&quot;true&quot;</code> in <code>~/.zshrc</code>. Auto updates will cause the
<code>~/.oh-my-zsh</code> directory to drift out of sync with chezmoi&rsquo;s source state. To
update Oh My Zsh and its plugins, refresh the downloaded archives.</p>
<hr>
<h3 id="include-a-single-file-from-another-repository">
  Include a single file from another repository
  <a class="anchor" href="#include-a-single-file-from-another-repository">#</a>
</h3>
<p>Including single files uses the same mechanism as including a subdirectory
above, except with the external type <code>file</code> instead of <code>archive</code>. For example,
to include
<a href="https://github.com/junegunn/vim-plug/blob/master/plug.vim"><code>plug.vim</code></a> from
<a href="https://github.com/junegunn/vim-plug"><code>github.com/junegunn/vim-plug</code></a> in
<code>~/.vim/autoload/plug.vim</code> put the following in
<code>~/.local/share/chezmoi/.chezmoiexternal.toml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#e6db74">&#34;.vim/autoload/plug.vim&#34;</span>]
    <span style="color:#a6e22e">type</span> = <span style="color:#e6db74">&#34;file&#34;</span>
    <span style="color:#a6e22e">url</span> = <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim&#34;</span>
    <span style="color:#a6e22e">refreshPeriod</span> = <span style="color:#e6db74">&#34;168h&#34;</span>
</code></pre></div><hr>
<h3 id="handle-configuration-files-which-are-externally-modified">
  Handle configuration files which are externally modified
  <a class="anchor" href="#handle-configuration-files-which-are-externally-modified">#</a>
</h3>
<p>Some programs modify their configuration files. When you next run <code>chezmoi apply</code>, any modifications made by the program will be lost.</p>
<p>You can track changes to these files by replacing with a symlink back to a file
in your source directory, which is under version control. Here is a worked
example for VSCode&rsquo;s <code>settings.json</code> on Linux:</p>
<p>Copy the configuration file to your source directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ cp ~/.config/Code/User/settings.json <span style="color:#66d9ef">$(</span>chezmoi source-path<span style="color:#66d9ef">)</span>
</code></pre></div><p>Tell chezmoi to ignore this file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ echo settings.json &gt;&gt; <span style="color:#66d9ef">$(</span>chezmoi source-path<span style="color:#66d9ef">)</span>/.chezmoiignore
</code></pre></div><p>Tell chezmoi that <code>~/.config/Code/User/settings.json</code> should be a symlink to the
file in your source directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ mkdir -p <span style="color:#66d9ef">$(</span>chezmoi source-path<span style="color:#66d9ef">)</span>/private_dot_config/private_Code/User
$ echo -n <span style="color:#e6db74">&#34;{{ .chezmoi.sourceDir }}/settings.json&#34;</span> &gt; <span style="color:#66d9ef">$(</span>chezmoi source-path<span style="color:#66d9ef">)</span>/private_dot_config/private_Code/User/symlink_settings.json.tmpl
</code></pre></div><p>The prefix <code>private_</code> is used because the <code>~/.config</code> and <code>~/.config/Code</code>
directories are private by default.</p>
<p>Apply the changes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi apply -v
</code></pre></div><p>Now, when the program modifies its configuration file it will modify the file in
the source state instead.</p>
<hr>
<h3 id="import-archives">
  Import archives
  <a class="anchor" href="#import-archives">#</a>
</h3>
<p>It is occasionally useful to import entire archives of configuration into your
source state. The <code>import</code> command does this. For example, to import the latest
version <a href="https://github.com/ohmyzsh/ohmyzsh"><code>github.com/ohmyzsh/ohmyzsh</code></a> to
<code>~/.oh-my-zsh</code> run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ curl -s -L -o <span style="color:#e6db74">${</span>TMPDIR<span style="color:#e6db74">}</span>/oh-my-zsh-master.tar.gz https://github.com/ohmyzsh/ohmyzsh/archive/master.tar.gz
$ mkdir -p <span style="color:#66d9ef">$(</span>chezmoi source-path<span style="color:#66d9ef">)</span>/dot_oh-my-zsh
$ chezmoi import --strip-components <span style="color:#ae81ff">1</span> --destination ~/.oh-my-zsh <span style="color:#e6db74">${</span>TMPDIR<span style="color:#e6db74">}</span>/oh-my-zsh-master.tar.gz
</code></pre></div><p>Note that this only updates the source state. You will need to run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi apply
</code></pre></div><p>to update your destination directory.</p>
<hr>
<h2 id="manage-machine-to-machine-differences">
  Manage machine-to-machine differences
  <a class="anchor" href="#manage-machine-to-machine-differences">#</a>
</h2>
<hr>
<h3 id="use-templates">
  Use templates
  <a class="anchor" href="#use-templates">#</a>
</h3>
<p>The primary goal of chezmoi is to manage configuration files across multiple
machines, for example your personal macOS laptop, your work Ubuntu desktop, and
your work Linux laptop. You will want to keep much configuration the same across
these, but also need machine-specific configurations for email addresses,
credentials, etc. chezmoi achieves this functionality by using
<a href="https://pkg.go.dev/text/template"><code>text/template</code></a> for the source state where
needed.</p>
<p>For example, your home <code>~/.gitconfig</code> on your personal machine might look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">user</span>]
    <span style="color:#a6e22e">email</span> = <span style="color:#e6db74">&#34;me@home.org&#34;</span>
</code></pre></div><p>Whereas at work it might be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">user</span>]
    <span style="color:#a6e22e">email</span> = <span style="color:#e6db74">&#34;firstname.lastname@company.com&#34;</span>
</code></pre></div><p>To handle this, on each machine create a configuration file called
<code>~/.config/chezmoi/chezmoi.toml</code> defining variables that might vary from machine
to machine. For example, for your home machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">data</span>]
    <span style="color:#a6e22e">email</span> = <span style="color:#e6db74">&#34;me@home.org&#34;</span>
</code></pre></div><p>Note that all variable names will be converted to lowercase. This is due to a
feature of a library used by chezmoi.</p>
<p>If you intend to store private data (e.g. access tokens) in
<code>~/.config/chezmoi/chezmoi.toml</code>, make sure it has permissions <code>0600</code>.</p>
<p>If you prefer, you can use any format supported by
<a href="https://github.com/spf13/viper">Viper</a> for your configuration file. This
includes JSON, YAML, and TOML. Variable names must start with a letter and be
followed by zero or more letters or digits.</p>
<p>Then, add <code>~/.gitconfig</code> to chezmoi using the <code>--autotemplate</code> flag to turn it
into a template and automatically detect variables from the <code>data</code> section
of your <code>~/.config/chezmoi/chezmoi.toml</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi add --autotemplate ~/.gitconfig
</code></pre></div><p>You can then open the template (which will be saved in the file
<code>~/.local/share/chezmoi/dot_gitconfig.tmpl</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi edit ~/.gitconfig
</code></pre></div><p>The file should look something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">user</span>]
    <span style="color:#a6e22e">email</span> = {{ .<span style="color:#a6e22e">email</span> <span style="color:#960050;background-color:#1e0010">|</span> <span style="color:#a6e22e">quote</span> }}
</code></pre></div><p>To disable automatic variable detection, use the <code>--template</code> or <code>-T</code> option to
<code>chezmoi add</code> instead of <code>--autotemplate</code>.</p>
<p>Templates are often used to capture machine-specific differences. For example,
in your <code>~/.local/share/chezmoi/dot_bashrc.tmpl</code> you might have:</p>
<pre tabindex="0"><code># common config
export EDITOR=vi

# machine-specific configuration
{{- if eq .chezmoi.hostname &quot;work-laptop&quot; }}
# this will only be included in ~/.bashrc on work-laptop
{{- end }}
</code></pre><p>For a full list of variables, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi data
</code></pre></div><p>For more advanced usage, you can use the full power of the
<a href="https://pkg.go.dev/text/template"><code>text/template</code></a> language. chezmoi includes
all of the text functions from <a href="http://masterminds.github.io/sprig/">sprig</a> and
its own <a href="/docs/reference/#template-functions">functions for interacting with password
managers</a>.</p>
<p>Templates can be executed directly from the command line, without the need to
create a file on disk, with the <code>execute-template</code> command, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi execute-template <span style="color:#e6db74">&#34;{{ .chezmoi.os }}/{{ .chezmoi.arch }}&#34;</span>
</code></pre></div><p>This is useful when developing or debugging templates.</p>
<p>Some password managers allow you to store complete files. The files can be
retrieved with chezmoi&rsquo;s template functions. For example, if you have a file
stored in 1Password with the UUID <code>uuid</code> then you can retrieve it with the
template:</p>
<pre tabindex="0"><code>{{- onepasswordDocument &quot;uuid&quot; -}}
</code></pre><p>The <code>-</code>s inside the brackets remove any whitespace before or after the template
expression, which is useful if your editor has added any newlines.</p>
<p>If, after executing the template, the file contents are empty, the target file
will be removed. This can be used to ensure that files are only present on
certain machines. If you want an empty file to be created anyway, you will need
to give it an <code>empty_</code> prefix.</p>
<hr>
<h3 id="ignore-files-or-a-directory-on-different-machines">
  Ignore files or a directory on different machines
  <a class="anchor" href="#ignore-files-or-a-directory-on-different-machines">#</a>
</h3>
<p>For coarser-grained control of files and entire directories managed on different
machines, or to exclude certain files completely, you can create
<code>.chezmoiignore</code> files in the source directory. These specify a list of patterns
that chezmoi should ignore, and are interpreted as templates. An example
<code>.chezmoiignore</code> file might look like:</p>
<pre tabindex="0"><code>README.md
{{- if ne .chezmoi.hostname &quot;work-laptop&quot; }}
.work # only manage .work on work-laptop
{{- end }}
</code></pre><p>The use of <code>ne</code> (not equal) is deliberate. What we want to achieve is &ldquo;only
install <code>.work</code> if hostname is <code>work-laptop</code>&rdquo; but chezmoi installs everything by
default, so we have to turn the logic around and instead write &ldquo;ignore <code>.work</code>
unless the hostname is <code>work-laptop</code>&rdquo;.</p>
<p>Patterns can be excluded by prefixing them with a <code>!</code>, for example:</p>
<pre tabindex="0"><code>f*
!foo
</code></pre><p>will ignore all files beginning with an <code>f</code> except <code>foo</code>.</p>
<hr>
<h3 id="use-completely-different-dotfiles-on-different-machines">
  Use completely different dotfiles on different machines
  <a class="anchor" href="#use-completely-different-dotfiles-on-different-machines">#</a>
</h3>
<p>chezmoi&rsquo;s template functionality allows you to change a file&rsquo;s contents based on
any variable. For example, if you want <code>~/.bashrc</code> to be different on Linux and
macOS you would create a file in the source state called <code>dot_bashrc.tmpl</code>
containing:</p>
<pre tabindex="0"><code>{{ if eq .chezmoi.os &quot;darwin&quot; -}}
# macOS .bashrc contents
{{ else if eq .chezmoi.os &quot;linux&quot; -}}
# Linux .bashrc contents
{{ end -}}
</code></pre><p>However, if the differences between the two versions are so large that you&rsquo;d
prefer to use completely separate files in the source state, you can achieve
this using a symbolic link template. Create the following files:</p>
<p><code>symlink_dot_bashrc.tmpl</code>:</p>
<pre tabindex="0"><code>.bashrc_{{ .chezmoi.os }}
</code></pre><p><code>dot_bashrc_darwin</code>:</p>
<pre tabindex="0"><code>  # macOS .bashrc contents
</code></pre><p><code>dot_bashrc_linux</code>:</p>
<pre tabindex="0"><code># Linux .bashrc contents
</code></pre><p><code>.chezmoiignore</code></p>
<pre tabindex="0"><code>{{ if ne .chezmoi.os &quot;darwin&quot; }}
.bashrc_darwin
{{ end }}
{{ if ne .chezmoi.os &quot;linux&quot; }}
.bashrc_linux
{{ end }}
</code></pre><p>This will make <code>~/.bashrc</code> a symlink to <code>.bashrc_darwin</code> on <code>darwin</code> and to
<code>.bashrc_linux</code> on <code>linux</code>. The <code>.chezmoiignore</code> configuration ensures that only
the OS-specific <code>.bashrc_os</code> file will be installed on each OS.</p>
<h4 id="without-using-symlinks">
  Without using symlinks
  <a class="anchor" href="#without-using-symlinks">#</a>
</h4>
<p>The same thing can be achieved using the include function.</p>
<p><code>dot_bashrc.tmpl</code></p>
<pre tabindex="0"><code>{{ if eq .chezmoi.os &quot;darwin&quot; }}
{{   include &quot;.bashrc_darwin&quot; }}
{{ end }}
{{ if eq .chezmoi.os &quot;linux&quot; }}
{{   include &quot;.bashrc_linux&quot; }}
{{ end }}
</code></pre><hr>
<h3 id="create-a-config-file-on-a-new-machine-automatically">
  Create a config file on a new machine automatically
  <a class="anchor" href="#create-a-config-file-on-a-new-machine-automatically">#</a>
</h3>
<p><code>chezmoi init</code> can also create a config file automatically, if one does not
already exist. If your repo contains a file called <code>.chezmoi.&lt;format&gt;.tmpl</code>
where <em>format</em> is one of the supported config file formats (e.g. <code>json</code>, <code>toml</code>,
or <code>yaml</code>) then <code>chezmoi init</code> will execute that template to generate your
initial config file.</p>
<p>Specifically, if you have <code>.chezmoi.toml.tmpl</code> that looks like this:</p>
<pre tabindex="0"><code>{{- $email := promptString &quot;email&quot; -}}
[data]
    email = {{ $email | quote }}
</code></pre><p>Then <code>chezmoi init</code> will create an initial <code>chezmoi.toml</code> using this template.
<code>promptString</code> is a special function that prompts the user (you) for a value.</p>
<p>To test this template, use <code>chezmoi execute-template</code> with the <code>--init</code> and
<code>--promptString</code> flags, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi execute-template --init --promptString email<span style="color:#f92672">=</span>me@home.org &lt; ~/.local/share/chezmoi/.chezmoi.toml.tmpl
</code></pre></div><hr>
<h3 id="re-create-your-config-file">
  Re-create your config file
  <a class="anchor" href="#re-create-your-config-file">#</a>
</h3>
<p>If you change your config file template, chezmoi will warn you if your current
config file was not generated from that template. You can re-generate your
config file by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi init
</code></pre></div><p>If you are using any <code>prompt*</code> template functions in your config file template
you will be prompted again. However, you can avoid this with the following
example template logic:</p>
<pre tabindex="0"><code>{{- $email := &quot;&quot; -}}
{{- if (hasKey . &quot;email&quot;) -}}
{{-   $email = .email -}}
{{- else -}}
{{-   $email = promptString &quot;email&quot; -}}
{{- end -}}

[data]
    email = {{ $email | quote }}
</code></pre><p>This will cause chezmoi to first try to re-use the existing <code>$email</code> variable
and fallback to <code>promptString</code> only if it is not set.</p>
<hr>
<h3 id="handle-different-file-locations-on-different-systems-with-the-same-contents">
  Handle different file locations on different systems with the same contents
  <a class="anchor" href="#handle-different-file-locations-on-different-systems-with-the-same-contents">#</a>
</h3>
<p>If you want to have the same file contents in different locations on different
systems, but maintain only a single file in your source state, you can use
a shared template.</p>
<p>Create the common file in the <code>.chezmoitemplates</code> directory in the source state. For
example, create <code>.chezmoitemplates/file.conf</code>. The contents of this file are
available in templates with the <code>template *name* .</code> function where <em>name</em> is the
name of the file (<code>.</code> passes the current data to the template code in <code>file.conf</code>;
see <a href="https://pkg.go.dev/text/template#hdr-Actions">https://pkg.go.dev/text/template#hdr-Actions</a> for details).</p>
<p>Then create files for each system, for example <code>Library/Application Support/App/file.conf.tmpl</code> for macOS and <code>dot_config/app/file.conf.tmpl</code> for
Linux. Both template files should contain <code>{{- template &quot;file.conf&quot; . -}}</code>.</p>
<p>Finally, tell chezmoi to ignore files where they are not needed by adding lines
to your <code>.chezmoiignore</code> file, for example:</p>
<pre tabindex="0"><code>{{ if ne .chezmoi.os &quot;darwin&quot; }}
Library/Application Support/App/file.conf
{{ end }}
{{ if ne .chezmoi.os &quot;linux&quot; }}
.config/app/file.conf
{{ end }}
</code></pre><hr>
<h3 id="create-an-archive-of-your-dotfiles">
  Create an archive of your dotfiles
  <a class="anchor" href="#create-an-archive-of-your-dotfiles">#</a>
</h3>
<p><code>chezmoi archive</code> creates an archive containing the target state. This can be
useful for generating target state for a different machine. You can specify a
different configuration file (including template variables) with the <code>--config</code>
option.</p>
<hr>
<h2 id="keep-data-private">
  Keep data private
  <a class="anchor" href="#keep-data-private">#</a>
</h2>
<p>chezmoi automatically detects when files and directories are private when adding
them by inspecting their permissions. Private files and directories are stored
in <code>~/.local/share/chezmoi</code> as regular, public files with permissions <code>0644</code> and
the name prefix <code>private_</code>. For example:</p>
<pre tabindex="0"><code>$ chezmoi add ~/.netrc
</code></pre><p>will create <code>~/.local/share/chezmoi/private_dot_netrc</code> (assuming <code>~/.netrc</code> is
not world- or group- readable, as it should be). This file is still private
because <code>~/.local/share/chezmoi</code> is not group- or world- readable or executable.
chezmoi checks that the permissions of <code>~/.local/share/chezmoi</code> are <code>0700</code> on
every run and will print a warning if they are not.</p>
<p>It is common that you need to store access tokens in config files, e.g. a
<a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">GitHub access
token</a>.
There are several ways to keep these tokens secure, and to prevent them leaving
your machine.</p>
<hr>
<h3 id="use-1password">
  Use 1Password
  <a class="anchor" href="#use-1password">#</a>
</h3>
<p>chezmoi includes support for <a href="https://1password.com/">1Password</a> using the
<a href="https://support.1password.com/command-line-getting-started/">1Password CLI</a> to
expose data as a template function.</p>
<p>Log in and get a session using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ eval <span style="color:#66d9ef">$(</span>op signin &lt;subdomain&gt;.1password.com &lt;email&gt;<span style="color:#66d9ef">)</span>
</code></pre></div><p>The output of <code>op get item &lt;uuid&gt;</code> is available as the <code>onepassword</code> template
function. chezmoi parses the JSON output and returns it as structured data. For
example, if the output of <code>op get item &quot;&lt;uuid&gt;&quot;</code> is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;uuid&#34;</span>: <span style="color:#e6db74">&#34;&lt;uuid&gt;&#34;</span>,
    <span style="color:#f92672">&#34;details&#34;</span>: {
        <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;xxx&#34;</span>
    }
}
</code></pre></div><p>Then you can access <code>details.password</code> with the syntax:</p>
<pre tabindex="0"><code>{{ (onepassword &quot;&lt;uuid&gt;&quot;).details.password }}
</code></pre><p>Login details fields can be retrieved with the <code>onepasswordDetailsFields</code>
function, for example:</p>
<pre tabindex="0"><code>{{- (onepasswordDetailsFields &quot;uuid&quot;).password.value }}
</code></pre><p>Documents can be retrieved with:</p>
<pre tabindex="0"><code>{{- onepasswordDocument &quot;uuid&quot; -}}
</code></pre><p>Note the extra <code>-</code> after the opening <code>{{</code> and before the closing <code>}}</code>. This
instructs the template language to remove any whitespace before and after the
substitution. This removes any trailing newline added by your editor when saving
the template.</p>
<h4 id="1password-sign-in-prompt">
  1Password sign-in prompt
  <a class="anchor" href="#1password-sign-in-prompt">#</a>
</h4>
<p>chezmoi will verify the availability and validity of a session token in the
current environment. If it is missing or expired, you will be interactively
prompted to sign-in again.</p>
<p>In the past chezmoi used to simply exit with an error when no valid session was
available. If you&rsquo;d like to restore that behavior, set the following option in
your configuration file (<code>chezmoi.toml</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">onepassword</span>]
    <span style="color:#a6e22e">prompt</span> = <span style="color:#66d9ef">false</span>
</code></pre></div><p><strong>A session token verified or acquired interactively will be passed to the
1Password CLI through a command-line parameter, which could be visible to other
users of the same system. You should disable the prompt on shared machines for
improved security.</strong></p>
<hr>
<h3 id="use-bitwarden">
  Use Bitwarden
  <a class="anchor" href="#use-bitwarden">#</a>
</h3>
<p>chezmoi includes support for <a href="https://bitwarden.com/">Bitwarden</a> using the
<a href="https://github.com/bitwarden/cli">Bitwarden CLI</a> to expose data as a template
function.</p>
<p>Log in to Bitwarden using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ bw login &lt;bitwarden-email&gt;
</code></pre></div><p>Unlock your Bitwarden vault:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ bw unlock
</code></pre></div><p>Set the <code>BW_SESSION</code> environment variable, as instructed.</p>
<p>The structured data from <code>bw get</code> is available as the <code>bitwarden</code> template
function in your config files, for example:</p>
<pre tabindex="0"><code>username = {{ (bitwarden &quot;item&quot; &quot;example.com&quot;).login.username }}
password = {{ (bitwarden &quot;item&quot; &quot;example.com&quot;).login.password }}
</code></pre><p>Custom fields can be accessed with the <code>bitwardenFields</code> template function. For
example, if you have a custom field named <code>token</code> you can retrieve its value
with:</p>
<pre tabindex="0"><code>{{ (bitwardenFields &quot;item&quot; &quot;example.com&quot;).token.value }}
</code></pre><hr>
<h3 id="use-gopass">
  Use gopass
  <a class="anchor" href="#use-gopass">#</a>
</h3>
<p>chezmoi includes support for <a href="https://www.gopass.pw/">gopass</a> using the gopass CLI.</p>
<p>The first line of the output of <code>gopass show &lt;pass-name&gt;</code> is available as the
<code>gopass</code> template function, for example:</p>
<pre tabindex="0"><code>{{ gopass &quot;&lt;pass-name&gt;&quot; }}
</code></pre><hr>
<h3 id="use-keepassxc">
  Use KeePassXC
  <a class="anchor" href="#use-keepassxc">#</a>
</h3>
<p>chezmoi includes support for <a href="https://keepassxc.org">KeePassXC</a> using the
KeePassXC CLI (<code>keepassxc-cli</code>) to expose data as a template function.</p>
<p>Provide the path to your KeePassXC database in your configuration file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">keepassxc</span>]
    <span style="color:#a6e22e">database</span> = <span style="color:#e6db74">&#34;/home/user/Passwords.kdbx&#34;</span>
</code></pre></div><p>The structured data from <code>keepassxc-cli show $database</code> is available as the
<code>keepassxc</code> template function in your config files, for example:</p>
<pre tabindex="0"><code>username = {{ (keepassxc &quot;example.com&quot;).UserName }}
password = {{ (keepassxc &quot;example.com&quot;).Password }}
</code></pre><p>Additional attributes are available through the <code>keepassxcAttribute</code> function.
For example, if you have an entry called <code>SSH Key</code> with an additional attribute
called <code>private-key</code>, its value is available as:</p>
<pre tabindex="0"><code>{{ keepassxcAttribute &quot;SSH Key&quot; &quot;private-key&quot; }}
</code></pre><hr>
<h3 id="use-keychain-or-windows-credentials-manager">
  Use Keychain or Windows Credentials Manager
  <a class="anchor" href="#use-keychain-or-windows-credentials-manager">#</a>
</h3>
<p>chezmoi includes support for Keychain (on macOS), GNOME Keyring (on Linux), and
Windows Credentials Manager (on Windows) via the
<a href="https://github.com/zalando/go-keyring"><code>zalando/go-keyring</code></a> library.</p>
<p>Set values with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi secret keyring set --service<span style="color:#f92672">=</span>&lt;service&gt; --user<span style="color:#f92672">=</span>&lt;user&gt;
Value: xxxxxxxx
</code></pre></div><p>The value can then be used in templates using the <code>keyring</code> function which takes
the service and user as arguments.</p>
<p>For example, save a GitHub access token in keyring with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi secret keyring set --service<span style="color:#f92672">=</span>github --user<span style="color:#f92672">=</span>&lt;github-username&gt;
Value: xxxxxxxx
</code></pre></div><p>and then include it in your <code>~/.gitconfig</code> file with:</p>
<pre tabindex="0"><code>[github]
    user = {{ .github.user | quote }}
    token = {{ keyring &quot;github&quot; .github.user | quote }}
</code></pre><p>You can query the keyring from the command line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi secret keyring get --service<span style="color:#f92672">=</span>github --user<span style="color:#f92672">=</span>&lt;github-username&gt;
</code></pre></div><hr>
<h3 id="use-lastpass">
  Use LastPass
  <a class="anchor" href="#use-lastpass">#</a>
</h3>
<p>chezmoi includes support for <a href="https://lastpass.com">LastPass</a> using the
<a href="https://lastpass.github.io/lastpass-cli/lpass.1.html">LastPass CLI</a> to expose
data as a template function.</p>
<p>Log in to LastPass using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ lpass login &lt;lastpass-username&gt;
</code></pre></div><p>Check that <code>lpass</code> is working correctly by showing password data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ lpass show --json &lt;lastpass-entry-id&gt;
</code></pre></div><p>where <code>&lt;lastpass-entry-id&gt;</code> is a <a href="https://lastpass.github.io/lastpass-cli/lpass.1.html#_entry_specification">LastPass Entry
Specification</a>.</p>
<p>The structured data from <code>lpass show --json id</code> is available as the <code>lastpass</code>
template function. The value will be an array of objects. You can use the
<code>index</code> function and <code>.Field</code> syntax of the <code>text/template</code> language to extract
the field you want. For example, to extract the <code>password</code> field from first the
&ldquo;GitHub&rdquo; entry, use:</p>
<pre tabindex="0"><code>githubPassword = {{ (index (lastpass &quot;GitHub&quot;) 0).password | quote }}
</code></pre><p>chezmoi automatically parses the <code>note</code> value of the Lastpass entry as
colon-separated key-value pairs, so, for example, you can extract a private SSH
key like this:</p>
<pre tabindex="0"><code>{{ (index (lastpass &quot;SSH&quot;) 0).note.privateKey }}
</code></pre><p>Keys in the <code>note</code> section written as <code>CamelCase Words</code> are converted to
<code>camelCaseWords</code>.</p>
<p>If the <code>note</code> value does not contain colon-separated key-value pairs, then you
can use <code>lastpassRaw</code> to get its raw value, for example:</p>
<pre tabindex="0"><code>{{ (index (lastpassRaw &quot;SSH Private Key&quot;) 0).note }}
</code></pre><hr>
<h3 id="use-pass">
  Use pass
  <a class="anchor" href="#use-pass">#</a>
</h3>
<p>chezmoi includes support for <a href="https://www.passwordstore.org/">pass</a> using the
pass CLI.</p>
<p>The first line of the output of <code>pass show &lt;pass-name&gt;</code> is available as the
<code>pass</code> template function, for example:</p>
<pre tabindex="0"><code>{{ pass &quot;&lt;pass-name&gt;&quot; }}
</code></pre><hr>
<h3 id="use-vault">
  Use Vault
  <a class="anchor" href="#use-vault">#</a>
</h3>
<p>chezmoi includes support for <a href="https://www.vaultproject.io/">Vault</a> using the
<a href="https://www.vaultproject.io/docs/commands/">Vault CLI</a> to expose data as a
template function.</p>
<p>The vault CLI needs to be correctly configured on your machine, e.g. the
<code>VAULT_ADDR</code> and <code>VAULT_TOKEN</code> environment variables must be set correctly.
Verify that this is the case by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ vault kv get -format<span style="color:#f92672">=</span>json &lt;key&gt;
</code></pre></div><p>The structured data from <code>vault kv get -format=json</code> is available as the <code>vault</code>
template function. You can use the <code>.Field</code> syntax of the <code>text/template</code>
language to extract the data you want. For example:</p>
<pre tabindex="0"><code>{{ (vault &quot;&lt;key&gt;&quot;).data.data.password }}
</code></pre><hr>
<h3 id="use-a-custom-password-manager">
  Use a custom password manager
  <a class="anchor" href="#use-a-custom-password-manager">#</a>
</h3>
<p>You can use any command line tool that outputs secrets either as a string or in
JSON format. Choose the binary by setting <code>secret.command</code> in your configuration
file. You can then invoke this command with the <code>secret</code> and <code>secretJSON</code>
template functions which return the raw output and JSON-decoded output
respectively. All of the above secret managers can be supported in this way:</p>
<table>
<thead>
<tr>
<th>Secret Manager</th>
<th><code>secret.command</code></th>
<th>Template skeleton</th>
</tr>
</thead>
<tbody>
<tr>
<td>1Password</td>
<td><code>op</code></td>
<td><code>{{ secretJSON &quot;get&quot; &quot;item&quot; &lt;id&gt; }}</code></td>
</tr>
<tr>
<td>Bitwarden</td>
<td><code>bw</code></td>
<td><code>{{ secretJSON &quot;get&quot; &lt;id&gt; }}</code></td>
</tr>
<tr>
<td>HashiCorp Vault</td>
<td><code>vault</code></td>
<td><code>{{ secretJSON &quot;kv&quot; &quot;get&quot; &quot;-format=json&quot; &lt;id&gt; }}</code></td>
</tr>
<tr>
<td>LastPass</td>
<td><code>lpass</code></td>
<td><code>{{ secretJSON &quot;show&quot; &quot;--json&quot; &lt;id&gt; }}</code></td>
</tr>
<tr>
<td>KeePassXC</td>
<td><code>keepassxc-cli</code></td>
<td>Not possible (interactive command only)</td>
</tr>
<tr>
<td>pass</td>
<td><code>pass</code></td>
<td><code>{{ secret &quot;show&quot; &lt;id&gt; }}</code></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="encrypt-whole-files-with-gpg">
  Encrypt whole files with gpg
  <a class="anchor" href="#encrypt-whole-files-with-gpg">#</a>
</h3>
<p>chezmoi supports encrypting files with <a href="https://www.gnupg.org/">gpg</a>. Encrypted
files are stored in the source state and automatically be decrypted when
generating the target state or printing a file&rsquo;s contents with <code>chezmoi cat</code>.
<code>chezmoi edit</code> will transparently decrypt the file before editing and re-encrypt
it afterwards.</p>
<hr>
<h4 id="asymmetric-privatepublic-key-encryption">
  Asymmetric (private/public-key) encryption
  <a class="anchor" href="#asymmetric-privatepublic-key-encryption">#</a>
</h4>
<p>Specify the encryption key to use in your configuration file (<code>chezmoi.toml</code>)
with the <code>gpg.recipient</code> key:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#a6e22e">encryption</span> = <span style="color:#e6db74">&#34;gpg&#34;</span>
[<span style="color:#a6e22e">gpg</span>]
    <span style="color:#a6e22e">recipient</span> = <span style="color:#e6db74">&#34;...&#34;</span>
</code></pre></div><p>Add files to be encrypted with the <code>--encrypt</code> flag, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi add --encrypt ~/.ssh/id_rsa
</code></pre></div><p>chezmoi will encrypt the file with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gpg --armor --recipient <span style="color:#e6db74">${</span>gpg.recipient<span style="color:#e6db74">}</span> --encrypt
</code></pre></div><p>and store the encrypted file in the source state. The file will automatically be
decrypted when generating the target state.</p>
<hr>
<h4 id="symmetric-encryption">
  Symmetric encryption
  <a class="anchor" href="#symmetric-encryption">#</a>
</h4>
<p>Specify symmetric encryption in your configuration file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#a6e22e">encryption</span> = <span style="color:#e6db74">&#34;gpg&#34;</span>
[<span style="color:#a6e22e">gpg</span>]
    <span style="color:#a6e22e">symmetric</span> = <span style="color:#66d9ef">true</span>
</code></pre></div><p>Add files to be encrypted with the <code>--encrypt</code> flag, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi add --encrypt ~/.ssh/id_rsa
</code></pre></div><p>chezmoi will encrypt the file with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gpg --armor --symmetric
</code></pre></div><hr>
<h3 id="encrypt-whole-files-with-age">
  Encrypt whole files with age
  <a class="anchor" href="#encrypt-whole-files-with-age">#</a>
</h3>
<p>chezmoi supports encrypting files with <a href="https://age-encryption.org/">age</a>.
Encrypted files are stored in the source state and automatically be decrypted
when generating the target state or printing a file&rsquo;s contents with <code>chezmoi cat</code>. <code>chezmoi edit</code> will transparently decrypt the file before editing and
re-encrypt it afterwards.</p>
<p>Generate a key using <code>age-keygen</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ age-keygen -o $HOME/key.txt
Public key: age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p
</code></pre></div><p>Specify age encryption in your configuration file, being sure to specify at
least the identity and one recipient:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#a6e22e">encryption</span> = <span style="color:#e6db74">&#34;age&#34;</span>
[<span style="color:#a6e22e">age</span>]
    <span style="color:#a6e22e">identity</span> = <span style="color:#e6db74">&#34;/home/user/key.txt&#34;</span>
    <span style="color:#a6e22e">recipient</span> = <span style="color:#e6db74">&#34;age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p&#34;</span>
</code></pre></div><p>Add files to be encrypted with the <code>--encrypt</code> flag, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi add --encrypt ~/.ssh/id_rsa
</code></pre></div><p>chezmoi supports multiple recipients and recipient files, and multiple
identities.</p>
<hr>
<h4 id="symmetric-encryption-1">
  Symmetric encryption
  <a class="anchor" href="#symmetric-encryption-1">#</a>
</h4>
<p>To use age&rsquo;s symmetric encryption, specify a single identity and enable
symmetric encryption in your config file, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#a6e22e">encryption</span> = <span style="color:#e6db74">&#34;age&#34;</span>
[<span style="color:#a6e22e">age</span>]
    <span style="color:#a6e22e">identity</span> = <span style="color:#e6db74">&#34;~/.ssh/id_rsa&#34;</span>
    <span style="color:#a6e22e">symmetric</span> = <span style="color:#66d9ef">true</span>
</code></pre></div><hr>
<h4 id="symmetric-encryption-with-a-passphrase">
  Symmetric encryption with a passphrase
  <a class="anchor" href="#symmetric-encryption-with-a-passphrase">#</a>
</h4>
<p>To use age&rsquo;s symmetric encryption with a passphrase, set <code>age.passphrase</code> to
<code>true</code> in your config file, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#a6e22e">encryption</span> = <span style="color:#e6db74">&#34;age&#34;</span>
[<span style="color:#a6e22e">age</span>]
    <span style="color:#a6e22e">passphrase</span> = <span style="color:#66d9ef">true</span>
</code></pre></div><p>You will be prompted for the passphrase whenever you run <code>chezmoi add --encrypt</code>
and whenever chezmoi needs to decrypt the file, for example when you run
<code>chezmoi apply</code>, <code>chezmoi diff</code>, or <code>chezmoi status</code>.</p>
<hr>
<h3 id="use-a-private-configuration-file-and-template-variables">
  Use a private configuration file and template variables
  <a class="anchor" href="#use-a-private-configuration-file-and-template-variables">#</a>
</h3>
<p>Typically, <code>~/.config/chezmoi/chezmoi.toml</code> is not checked in to version control
and has permissions 0600. You can store tokens as template values in the <code>data</code>
section. For example, if your <code>~/.config/chezmoi/chezmoi.toml</code> contains:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">github</span>]
    <span style="color:#a6e22e">user</span> = <span style="color:#e6db74">&#34;&lt;github-username&gt;&#34;</span>
    <span style="color:#a6e22e">token</span> = <span style="color:#e6db74">&#34;&lt;github-token&gt;&#34;</span>
</code></pre></div><p>Your <code>~/.local/share/chezmoi/private_dot_gitconfig.tmpl</code> can then contain:</p>
<pre tabindex="0"><code>{{- if (index . &quot;github&quot;) }}
[github]
    user = {{ .github.user | quote }}
    token = {{ .github.token | quote }}
{{- end }}
</code></pre><p>Any config files containing tokens in plain text should be private (permissions
<code>0600</code>).</p>
<hr>
<h2 id="use-scripts-to-perform-actions">
  Use scripts to perform actions
  <a class="anchor" href="#use-scripts-to-perform-actions">#</a>
</h2>
<hr>
<h3 id="understand-how-scripts-work">
  Understand how scripts work
  <a class="anchor" href="#understand-how-scripts-work">#</a>
</h3>
<p>chezmoi supports scripts, which are executed when you run <code>chezmoi apply</code>. The
scripts can either run every time you run <code>chezmoi apply</code>, or only when their
contents have changed.</p>
<p>In verbose mode, the script&rsquo;s contents will be printed before executing it. In
dry-run mode, the script is not executed.</p>
<p>Scripts are any file in the source directory with the prefix <code>run_</code>, and are
executed in alphabetical order. Scripts that should only be run if they have not
been run before have the prefix <code>run_once_</code>. Scripts that should be run whenever
their contents change have the <code>run_onchange_</code> prefix.</p>
<p>Scripts break chezmoi&rsquo;s declarative approach, and as such should be used
sparingly. Any script should be idempotent, even <code>run_once_</code> and
<code>run_onchange_</code> scripts.</p>
<p>Scripts must be created manually in the source directory, typically by running
<code>chezmoi cd</code> and then creating a file with a <code>run_</code> prefix. Scripts are executed
directly using <code>exec</code> and must include a shebang line or be executable binaries.
There is no need to set the executable bit on the script.</p>
<p>Scripts with the suffix <code>.tmpl</code> are treated as templates, with the usual
template variables available. If, after executing the template, the result is
only whitespace or an empty string, then the script is not executed. This is
useful for disabling scripts.</p>
<hr>
<h3 id="install-packages-with-scripts">
  Install packages with scripts
  <a class="anchor" href="#install-packages-with-scripts">#</a>
</h3>
<p>Change to the source directory and create a file called
<code>run_once_install-packages.sh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi cd
$ $EDITOR run_once_install-packages.sh
</code></pre></div><p>In this file create your package installation script, e.g.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>sudo apt install ripgrep
</code></pre></div><p>The next time you run <code>chezmoi apply</code> or <code>chezmoi update</code> this script will be
run. As it has the <code>run_once_</code> prefix, it will not be run again unless its
contents change, for example if you add more packages to be installed.</p>
<p>This script can also be a template. For example, if you create
<code>run_once_install-packages.sh.tmpl</code> with the contents:</p>
<pre tabindex="0"><code>{{ if eq .chezmoi.os &quot;linux&quot; -}}
#!/bin/sh
sudo apt install ripgrep
{{ else if eq .chezmoi.os &quot;darwin&quot; -}}
#!/bin/sh
brew install ripgrep
{{ end -}}
</code></pre><p>This will install <code>ripgrep</code> on both Debian/Ubuntu Linux systems and macOS.</p>
<hr>
<h3 id="run-a-script-when-the-contents-of-another-file-changes">
  Run a script when the contents of another file changes
  <a class="anchor" href="#run-a-script-when-the-contents-of-another-file-changes">#</a>
</h3>
<p>chezmoi&rsquo;s <code>run_</code> scripts are run every time you run <code>chezmoi apply</code>, whereas
<code>run_once_</code> scripts are run only when their contents have changed, after
executing them as templates. You use this to cause a <code>run_once_</code> script to run
when the contents of another file has changed by including a checksum of the
other file&rsquo;s contents in the script.</p>
<p>For example, if your <a href="https://wiki.gnome.org/Projects/dconf">dconf</a> settings are
stored in <code>dconf.ini</code> in your source directory then you can make <code>chezmoi apply</code>
only load them when the contents of <code>dconf.ini</code> has changed by adding the
following script as <code>run_once_dconf-load.sh.tmpl</code>:</p>
<pre tabindex="0"><code>#!/bin/bash

# dconf.ini hash: {{ include &quot;dconf.ini&quot; | sha256sum }}
dconf load / {{ joinPath .chezmoi.sourceDir &quot;dconf.ini&quot; | quote }}
</code></pre><p>As the SHA256 sum of <code>dconf.ini</code> is included in a comment in the script, the
contents of the script will change whenever the contents of <code>dconf.ini</code> are
changed, so chezmoi will re-run the script whenever the contents of <code>dconf.ini</code>
change.</p>
<p>In this example you should also add <code>dconf.ini</code> to <code>.chezmoiignore</code> so chezmoi
does not create <code>dconf.ini</code> in your home directory.</p>
<hr>
<h3 id="clear-the-state-of-run_once_-scripts">
  Clear the state of <code>run_once_</code> scripts
  <a class="anchor" href="#clear-the-state-of-run_once_-scripts">#</a>
</h3>
<p>chezmoi stores whether and when <code>run_once_</code> scripts have been run in the
<code>scriptState</code> bucket of its persistent state. To clear the state of <code>run_once_</code>
scripts, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi state delete-bucket --bucket<span style="color:#f92672">=</span>scriptState
</code></pre></div><hr>
<h2 id="use-chezmoi-on-macos">
  Use chezmoi on macOS
  <a class="anchor" href="#use-chezmoi-on-macos">#</a>
</h2>
<hr>
<h3 id="use-brew-bundle-to-manage-your-brews-and-casks">
  Use <code>brew bundle</code> to manage your brews and casks
  <a class="anchor" href="#use-brew-bundle-to-manage-your-brews-and-casks">#</a>
</h3>
<p>Homebrew&rsquo;s <a href="https://docs.brew.sh/Manpage#bundle-subcommand"><code>brew bundle</code>
subcommand</a> allows you to
specify a list of brews and casks to be installed. You can integrate this with
chezmoi by creating a <code>run_once_</code> script. For example, create a file in your
source directory called <code>run_once_before_install-packages-darwin.sh.tmpl</code>
containing:</p>
<pre tabindex="0"><code>{{- if (eq .chezmoi.os &quot;darwin&quot;) -}}
#!/bin/bash

brew bundle --no-lock --file=/dev/stdin &lt;&lt;EOF
brew &quot;git&quot;
cask &quot;google-chrome&quot;
EOF
{{ end -}}
</code></pre><p>Note that the <code>Brewfile</code> is embedded directly in the script with a bash here
document. chezmoi will run this script whenever its contents change, i.e. when
you add or remove brews or casks.</p>
<hr>
<h2 id="use-chezmoi-on-windows">
  Use chezmoi on Windows
  <a class="anchor" href="#use-chezmoi-on-windows">#</a>
</h2>
<hr>
<h3 id="detect-windows-subsystem-for-linux-wsl">
  Detect Windows Subsystem for Linux (WSL)
  <a class="anchor" href="#detect-windows-subsystem-for-linux-wsl">#</a>
</h3>
<p>WSL can be detected by looking for the string <code>Microsoft</code> or <code>microsoft</code> in
<code>/proc/sys/kernel/osrelease</code>, which is available in the template variable
<code>.chezmoi.kernel.osrelease</code>, for example:</p>
<pre tabindex="0"><code>{{ if (eq .chezmoi.os &quot;linux&quot;) }}
{{   if (.chezmoi.kernel.osrelease | lower | contains &quot;microsoft&quot;) }}
# WSL-specific code
{{   end }}
{{ end }}
</code></pre><hr>
<h3 id="run-a-powershell-script-as-admin-on-windows">
  Run a PowerShell script as admin on Windows
  <a class="anchor" href="#run-a-powershell-script-as-admin-on-windows">#</a>
</h3>
<p>Put the following at the top of your script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Self-elevate the script if required</span>
<span style="color:#66d9ef">if</span> (<span style="color:#f92672">-Not</span> (<span style="color:#66d9ef">[Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]</span>::GetCurrent()).IsInRole(<span style="color:#66d9ef">[Security.Principal.WindowsBuiltInRole]</span> <span style="color:#e6db74">&#39;Administrator&#39;</span>)) {
  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">[int]</span>(Get-CimInstance -Class Win32_OperatingSystem | Select-Object -ExpandProperty BuildNumber) <span style="color:#f92672">-ge</span> 6000) {
    $CommandLine = <span style="color:#e6db74">&#34;-NoExit -File </span><span style="color:#ae81ff">`&#34;</span><span style="color:#e6db74">&#34;</span> + $MyInvocation.MyCommand.Path + <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">`&#34;</span><span style="color:#e6db74"> &#34;</span> + $MyInvocation.UnboundArguments
    Start-Process -FilePath PowerShell.exe -Verb Runas -ArgumentList $CommandLine
    Exit
  }
}
</code></pre></div><hr>
<h2 id="use-chezmoi-with-github-codespaces-visual-studio-codespaces-or-visual-studio-code-remote---containers">
  Use chezmoi with GitHub Codespaces, Visual Studio Codespaces, or Visual Studio Code Remote - Containers
  <a class="anchor" href="#use-chezmoi-with-github-codespaces-visual-studio-codespaces-or-visual-studio-code-remote---containers">#</a>
</h2>
<p>The following assumes you are using chezmoi 1.8.4 or later. It does not work
with earlier versions of chezmoi.</p>
<p>You can use chezmoi to manage your dotfiles in <a href="https://docs.github.com/en/github/developing-online-with-codespaces/personalizing-codespaces-for-your-account">GitHub
Codespaces</a>,
<a href="https://docs.microsoft.com/en/visualstudio/codespaces/reference/personalizing">Visual Studio
Codespaces</a>,
and <a href="https://code.visualstudio.com/docs/remote/containers#_personalizing-with-dotfile-repositories">Visual Studio Code Remote -
Containers</a>.</p>
<p>For a quick start, you can clone the <a href="https://github.com/chezmoi/dotfiles"><code>chezmoi/dotfiles</code>
repository</a> which supports Codespaces out
of the box.</p>
<p>The workflow is different to using chezmoi on a new machine, notably:</p>
<ul>
<li>These systems will automatically clone your <code>dotfiles</code> repo to <code>~/dotfiles</code>,
so there is no need to clone your repo yourself.</li>
<li>The installation script must be non-interactive.</li>
<li>When running in a Codespace, the environment variable <code>CODESPACES</code> will be set
to <code>true</code>. You can read its value with the <a href="http://masterminds.github.io/sprig/os.html"><code>env</code> template
function</a>.</li>
</ul>
<p>First, if you are using a chezmoi configuration file template, ensure that it is
non-interactive when running in Codespaces, for example, <code>.chezmoi.toml.tmpl</code>
might contain:</p>
<pre tabindex="0"><code>{{- $codespaces:= env &quot;CODESPACES&quot; | not | not -}}
sourceDir = {{ .chezmoi.sourceDir | quote }}

[data]
    name = &quot;Your name&quot;
    codespaces = {{ $codespaces }}
{{- if $codespaces }}{{/* Codespaces dotfiles setup is non-interactive, so set an email address */}}
    email = &quot;your@email.com&quot;
{{- else }}{{/* Interactive setup, so prompt for an email address */}}
    email = {{ promptString &quot;email&quot; | quote }}
{{- end }}
</code></pre><p>This sets the <code>codespaces</code> template variable, so you don&rsquo;t have to repeat <code>(env &quot;CODESPACES&quot;)</code> in your templates. It also sets the <code>sourceDir</code> configuration to
the <code>--source</code> argument passed in <code>chezmoi init</code>.</p>
<p>Second, create an <code>install.sh</code> script that installs chezmoi and your dotfiles:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
set -e <span style="color:#75715e"># -e: exit on error</span>

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>command -v chezmoi<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
  bin_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$HOME<span style="color:#e6db74">/.local/bin&#34;</span>
  chezmoi<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$bin_dir<span style="color:#e6db74">/chezmoi&#34;</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>command -v curl<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -fsLS https://chezmoi.io/get<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -- -b <span style="color:#e6db74">&#34;</span>$bin_dir<span style="color:#e6db74">&#34;</span>
  <span style="color:#66d9ef">elif</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>command -v wget<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>wget -qO- https://chezmoi.io/get<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -- -b <span style="color:#e6db74">&#34;</span>$bin_dir<span style="color:#e6db74">&#34;</span>
  <span style="color:#66d9ef">else</span>
    echo <span style="color:#e6db74">&#34;To install chezmoi, you must have curl or wget installed.&#34;</span> &gt;&amp;<span style="color:#ae81ff">2</span>
    exit <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">fi</span>
<span style="color:#66d9ef">else</span>
  chezmoi<span style="color:#f92672">=</span>chezmoi
<span style="color:#66d9ef">fi</span>

<span style="color:#75715e"># POSIX way to get script&#39;s dir: https://stackoverflow.com/a/29834779/12156188</span>
script_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>cd -P -- <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>dirname -- <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>command -v -- <span style="color:#e6db74">&#34;</span>$0<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span> pwd -P<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
<span style="color:#75715e"># exec: replace current process with chezmoi init</span>
exec <span style="color:#e6db74">&#34;</span>$chezmoi<span style="color:#e6db74">&#34;</span> init --apply <span style="color:#e6db74">&#34;--source=</span>$script_dir<span style="color:#e6db74">&#34;</span>
</code></pre></div><p>Ensure that this file is executable (<code>chmod a+x install.sh</code>), and add
<code>install.sh</code> to your <code>.chezmoiignore</code> file.</p>
<p>It installs the latest version of chezmoi in <code>~/.local/bin</code> if needed, and then
<code>chezmoi init ...</code> invokes chezmoi to create its configuration file and
initialize your dotfiles. <code>--apply</code> tells chezmoi to apply the changes
immediately, and <code>--source=...</code> tells chezmoi where to find the cloned
<code>dotfiles</code> repo, which in this case is the same folder in which the script is
running from.</p>
<p>If you do not use a chezmoi configuration file template you can use <code>chezmoi apply --source=$HOME/dotfiles</code> instead of <code>chezmoi init ...</code> in <code>install.sh</code>.</p>
<p>Finally, modify any of your templates to use the <code>codespaces</code> variable if
needed. For example, to install <code>vim-gtk</code> on Linux but not in Codespaces, your
<code>run_once_install-packages.sh.tmpl</code> might contain:</p>
<pre tabindex="0"><code>{{- if (and (eq .chezmoi.os &quot;linux&quot;) (not .codespaces)) -}}
#!/bin/sh
sudo apt install -y vim-gtk
{{- end -}}
</code></pre><hr>
<h2 id="customize-chezmoi">
  Customize chezmoi
  <a class="anchor" href="#customize-chezmoi">#</a>
</h2>
<hr>
<h3 id="use-a-subdirectory-of-your-dotfiles-repo-as-the-root-of-the-source-state">
  Use a subdirectory of your dotfiles repo as the root of the source state
  <a class="anchor" href="#use-a-subdirectory-of-your-dotfiles-repo-as-the-root-of-the-source-state">#</a>
</h3>
<p>By default, chezmoi uses the root of your dotfiles repo as the root of the
source state. If your source state contains many entries in its root, then your
target directory (usually your home directory) will in turn be filled with many
entries in its root as well. You can reduce the number of entries by keeping
<code>.chezmoiignore</code> up to date, but this can become tiresome.</p>
<p>Instead, you can specify that chezmoi should read the source state from a
subdirectory of the source directory instead by creating a file called
<code>.chezmoiroot</code> containing the relative path to this subdirectory.</p>
<p>For example, if <code>.chezmoiroot</code> contains:</p>
<pre tabindex="0"><code>home
</code></pre><p>Then chezmoi will read the source state from the <code>home</code> subdirectory of your
source directory, for example the desired state of <code>~/.gitconfig</code> will be read
from <code>~/.local/share/chezmoi/home/dot_gitconfig</code> (instead of
<code>~/.local/share/chezmoi/dot_gitconfig</code>).</p>
<p>When migrating an existing chezmoi dotfiles repo to use <code>.chezmoiroot</code> you will
need to move the relevant files in to the new root subdirectory manually. You do
not need to move files that are ignored by chezmoi in all cases (i.e. are listed
in <code>.chezmoiignore</code> when executed as a template on all machines), and you can
afterwards remove their entries from <code>home/.chezmoiignore</code>.</p>
<hr>
<h3 id="dont-show-scripts-in-the-diff-output">
  Don&rsquo;t show scripts in the diff output
  <a class="anchor" href="#dont-show-scripts-in-the-diff-output">#</a>
</h3>
<p>By default, <code>chezmoi diff</code> will show all changes, including the contents of
scripts that will be run. You can exclude scripts from the diff output by
setting the <code>diff.exclude</code> configuration variable in your configuration file,
for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">diff</span>]
    <span style="color:#a6e22e">exclude</span> = [<span style="color:#e6db74">&#34;scripts&#34;</span>]
</code></pre></div><hr>
<h3 id="customize-the-diff-pager">
  Customize the diff pager
  <a class="anchor" href="#customize-the-diff-pager">#</a>
</h3>
<p>You can change the diff format, and/or pipe the output into a pager of your
choice by setting <code>diff.pager</code> configuration variable. For example, to use
<a href="https://github.com/so-fancy/diff-so-fancy"><code>diff-so-fancy</code></a> specify:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">diff</span>]
    <span style="color:#a6e22e">pager</span> = <span style="color:#e6db74">&#34;diff-so-fancy&#34;</span>
</code></pre></div><p>The pager can be disabled using the <code>--no-pager</code> flag or by setting <code>diff.pager</code>
to an empty string.</p>
<hr>
<h3 id="use-a-custom-diff-tool">
  Use a custom diff tool
  <a class="anchor" href="#use-a-custom-diff-tool">#</a>
</h3>
<p>By default, chezmoi uses a built-in diff. You can use a custom tool by setting
the <code>diff.command</code> and <code>diff.args</code> configuration variables. The elements of
<code>diff.args</code> are interpreted as templates with the variables <code>.Destination</code> and
<code>.Target</code> containing filenames of the file in the destination state and the
target state respectively. For example, to use <a href="https://meldmerge.org/">meld</a>,
specify:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">diff</span>]
    <span style="color:#a6e22e">command</span> = <span style="color:#e6db74">&#34;meld&#34;</span>
    <span style="color:#a6e22e">args</span> = [<span style="color:#e6db74">&#34;--diff&#34;</span>, <span style="color:#e6db74">&#34;{{ .Destination }}&#34;</span>, <span style="color:#e6db74">&#34;{{ .Target }}&#34;</span>]
</code></pre></div><hr>
<h3 id="use-a-custom-merge-tool">
  Use a custom merge tool
  <a class="anchor" href="#use-a-custom-merge-tool">#</a>
</h3>
<p>By default, chezmoi uses vimdiff. You can use a custom tool by setting the
<code>merge.command</code> and <code>merge.args</code> configuration variables. The elements of
<code>merge.args</code> are interprested as templates with the variables <code>.Destination</code>,
<code>.Source</code>, and <code>.Target</code> containing filenames of the file in the destination
state, source state, and target state respectively. For example, to use
<a href="https://neovim.io/doc/user/diff.html">neovim&rsquo;s diff mode</a>, specify:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">merge</span>]
    <span style="color:#a6e22e">command</span> = <span style="color:#e6db74">&#34;nvim&#34;</span>
    <span style="color:#a6e22e">args</span> = [<span style="color:#e6db74">&#34;-d&#34;</span>, <span style="color:#e6db74">&#34;{{ .Destination }}&#34;</span>, <span style="color:#e6db74">&#34;{{ .Source }}&#34;</span>, <span style="color:#e6db74">&#34;{{ .Target }}&#34;</span>]
</code></pre></div><hr>
<h3 id="use-an-http-or-socks5-proxy">
  Use an HTTP or SOCKS5 proxy
  <a class="anchor" href="#use-an-http-or-socks5-proxy">#</a>
</h3>
<p>chezmoi supports HTTP, HTTPS, and SOCKS5 proxies. Set the <code>HTTP_PROXY</code>,
<code>HTTPS_PROXY</code>, and <code>NO_PROXY</code> environment variables, or their lowercase
equivalents, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ HTTP_PROXY<span style="color:#f92672">=</span>socks5://127.0.0.1:1080 chezmoi apply -R
</code></pre></div><hr>
<h2 id="migrating-to-chezmoi-from-another-dotfile-manager">
  Migrating to chezmoi from another dotfile manager
  <a class="anchor" href="#migrating-to-chezmoi-from-another-dotfile-manager">#</a>
</h2>
<hr>
<h3 id="migrate-from-a-dotfile-manager-that-uses-symlinks">
  Migrate from a dotfile manager that uses symlinks
  <a class="anchor" href="#migrate-from-a-dotfile-manager-that-uses-symlinks">#</a>
</h3>
<p>Many dotfile managers replace dotfiles with symbolic links to files in a common
directory. If you <code>chezmoi add</code> such a symlink, chezmoi will add the symlink,
not the file. To assist with migrating from symlink-based systems, use the
<code>--follow</code> option to <code>chezmoi add</code>, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ chezmoi add --follow ~/.bashrc
</code></pre></div><p>This will tell <code>chezmoi add</code> that the target state of <code>~/.bashrc</code> is the target
of the <code>~/.bashrc</code> symlink, rather than the symlink itself. When you run
<code>chezmoi apply</code>, chezmoi will replace the <code>~/.bashrc</code> symlink with the file
contents.</p>
<hr>
<h2 id="migrate-away-from-chezmoi">
  Migrate away from chezmoi
  <a class="anchor" href="#migrate-away-from-chezmoi">#</a>
</h2>
<p>chezmoi provides several mechanisms to help you move to an alternative dotfile
manager (or even no dotfile manager at all) in the future:</p>
<ul>
<li>chezmoi creates your dotfiles just as if you were not using a dotfile manager
at all. Your dotfiles are regular files, directories, and symlinks. You can
run <a href="/docs/reference/#purge"><code>chezmoi purge</code></a>
to delete all traces of chezmoi and then, if you&rsquo;re migrating to a new dotfile
manager, then you can use whatever mechanism it provides to add your dotfiles
to your new system.</li>
<li>chezmoi has a <a href="/docs/reference/#archive"><code>chezmoi archive</code></a>
command that generates a tarball of your dotfiles. You can replace the
contents of your dotfiles repo with the contents of the archive and you&rsquo;ve
effectively immediately migrated away from chezmoi.</li>
<li>chezmoi has a <a href="/docs/reference/#dump-target"><code>chezmoi dump</code></a>
command that dumps the interpreted (target) state in a machine-readable form,
so you can write scripts around chezmoi.</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#perform-daily-operations">Perform daily operations</a>
      <ul>
        <li><a href="#use-a-hosted-repo-to-manage-your-dotfiles-across-multiple-machines">Use a hosted repo to manage your dotfiles across multiple machines</a></li>
        <li><a href="#use-a-private-repo-to-store-your-dotfiles">Use a private repo to store your dotfiles</a></li>
        <li><a href="#pull-the-latest-changes-from-your-repo-and-apply-them">Pull the latest changes from your repo and apply them</a></li>
        <li><a href="#pull-the-latest-changes-from-your-repo-and-see-what-would-change-without-actually-applying-the-changes">Pull the latest changes from your repo and see what would change, without actually applying the changes</a></li>
        <li><a href="#automatically-commit-and-push-changes-to-your-repo">Automatically commit and push changes to your repo</a></li>
        <li><a href="#install-chezmoi-and-your-dotfiles-on-a-new-machine-with-a-single-command">Install chezmoi and your dotfiles on a new machine with a single command</a></li>
      </ul>
    </li>
    <li><a href="#manage-different-types-of-file">Manage different types of file</a>
      <ul>
        <li><a href="#have-chezmoi-create-a-directory-but-ignore-its-contents">Have chezmoi create a directory, but ignore its contents</a></li>
        <li><a href="#ensure-that-a-target-is-removed">Ensure that a target is removed</a></li>
        <li><a href="#manage-part-but-not-all-of-a-file">Manage part, but not all, of a file</a></li>
        <li><a href="#manage-a-files-permissions-but-not-its-contents">Manage a file&rsquo;s permissions, but not its contents</a></li>
        <li><a href="#populate-sshauthorized_keys-with-your-public-ssh-keys-from-github">Populate <code>~/.ssh/authorized_keys</code> with your public SSH keys from GitHub</a></li>
      </ul>
    </li>
    <li><a href="#integrate-chezmoi-with-your-editor">Integrate chezmoi with your editor</a>
      <ul>
        <li><a href="#use-your-preferred-editor-with-chezmoi-edit-and-chezmoi-edit-config">Use your preferred editor with <code>chezmoi edit</code> and <code>chezmoi edit-config</code></a></li>
        <li><a href="#configure-vim-to-run-chezmoi-apply-whenever-you-save-a-dotfile">Configure VIM to run <code>chezmoi apply</code> whenever you save a dotfile</a></li>
      </ul>
    </li>
    <li><a href="#include-dotfiles-from-elsewhere">Include dotfiles from elsewhere</a>
      <ul>
        <li><a href="#include-a-subdirectory-from-another-repository-like-oh-my-zsh">Include a subdirectory from another repository, like Oh My Zsh</a></li>
        <li><a href="#include-a-single-file-from-another-repository">Include a single file from another repository</a></li>
        <li><a href="#handle-configuration-files-which-are-externally-modified">Handle configuration files which are externally modified</a></li>
        <li><a href="#import-archives">Import archives</a></li>
      </ul>
    </li>
    <li><a href="#manage-machine-to-machine-differences">Manage machine-to-machine differences</a>
      <ul>
        <li><a href="#use-templates">Use templates</a></li>
        <li><a href="#ignore-files-or-a-directory-on-different-machines">Ignore files or a directory on different machines</a></li>
        <li><a href="#use-completely-different-dotfiles-on-different-machines">Use completely different dotfiles on different machines</a></li>
        <li><a href="#create-a-config-file-on-a-new-machine-automatically">Create a config file on a new machine automatically</a></li>
        <li><a href="#re-create-your-config-file">Re-create your config file</a></li>
        <li><a href="#handle-different-file-locations-on-different-systems-with-the-same-contents">Handle different file locations on different systems with the same contents</a></li>
        <li><a href="#create-an-archive-of-your-dotfiles">Create an archive of your dotfiles</a></li>
      </ul>
    </li>
    <li><a href="#keep-data-private">Keep data private</a>
      <ul>
        <li><a href="#use-1password">Use 1Password</a></li>
        <li><a href="#use-bitwarden">Use Bitwarden</a></li>
        <li><a href="#use-gopass">Use gopass</a></li>
        <li><a href="#use-keepassxc">Use KeePassXC</a></li>
        <li><a href="#use-keychain-or-windows-credentials-manager">Use Keychain or Windows Credentials Manager</a></li>
        <li><a href="#use-lastpass">Use LastPass</a></li>
        <li><a href="#use-pass">Use pass</a></li>
        <li><a href="#use-vault">Use Vault</a></li>
        <li><a href="#use-a-custom-password-manager">Use a custom password manager</a></li>
        <li><a href="#encrypt-whole-files-with-gpg">Encrypt whole files with gpg</a></li>
        <li><a href="#encrypt-whole-files-with-age">Encrypt whole files with age</a></li>
        <li><a href="#use-a-private-configuration-file-and-template-variables">Use a private configuration file and template variables</a></li>
      </ul>
    </li>
    <li><a href="#use-scripts-to-perform-actions">Use scripts to perform actions</a>
      <ul>
        <li><a href="#understand-how-scripts-work">Understand how scripts work</a></li>
        <li><a href="#install-packages-with-scripts">Install packages with scripts</a></li>
        <li><a href="#run-a-script-when-the-contents-of-another-file-changes">Run a script when the contents of another file changes</a></li>
        <li><a href="#clear-the-state-of-run_once_-scripts">Clear the state of <code>run_once_</code> scripts</a></li>
      </ul>
    </li>
    <li><a href="#use-chezmoi-on-macos">Use chezmoi on macOS</a>
      <ul>
        <li><a href="#use-brew-bundle-to-manage-your-brews-and-casks">Use <code>brew bundle</code> to manage your brews and casks</a></li>
      </ul>
    </li>
    <li><a href="#use-chezmoi-on-windows">Use chezmoi on Windows</a>
      <ul>
        <li><a href="#detect-windows-subsystem-for-linux-wsl">Detect Windows Subsystem for Linux (WSL)</a></li>
        <li><a href="#run-a-powershell-script-as-admin-on-windows">Run a PowerShell script as admin on Windows</a></li>
      </ul>
    </li>
    <li><a href="#use-chezmoi-with-github-codespaces-visual-studio-codespaces-or-visual-studio-code-remote---containers">Use chezmoi with GitHub Codespaces, Visual Studio Codespaces, or Visual Studio Code Remote - Containers</a></li>
    <li><a href="#customize-chezmoi">Customize chezmoi</a>
      <ul>
        <li><a href="#use-a-subdirectory-of-your-dotfiles-repo-as-the-root-of-the-source-state">Use a subdirectory of your dotfiles repo as the root of the source state</a></li>
        <li><a href="#dont-show-scripts-in-the-diff-output">Don&rsquo;t show scripts in the diff output</a></li>
        <li><a href="#customize-the-diff-pager">Customize the diff pager</a></li>
        <li><a href="#use-a-custom-diff-tool">Use a custom diff tool</a></li>
        <li><a href="#use-a-custom-merge-tool">Use a custom merge tool</a></li>
        <li><a href="#use-an-http-or-socks5-proxy">Use an HTTP or SOCKS5 proxy</a></li>
      </ul>
    </li>
    <li><a href="#migrating-to-chezmoi-from-another-dotfile-manager">Migrating to chezmoi from another dotfile manager</a>
      <ul>
        <li><a href="#migrate-from-a-dotfile-manager-that-uses-symlinks">Migrate from a dotfile manager that uses symlinks</a></li>
      </ul>
    </li>
    <li><a href="#migrate-away-from-chezmoi">Migrate away from chezmoi</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












